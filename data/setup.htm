<html><head><meta charset=utf-8 /><meta http-equiv=Cache-Control content=no-cache /><link rel="shortcut icon" href=/favicon.ico type=image/x-icon /><link rel=stylesheet href=/style.css /><title>Самовар</title><script>function openTab(n,t){for(var r,u=document.getElementsByClassName("tabcontent"),i=0;i<u.length;i++)u[i].style.display="none";for(r=document.getElementsByClassName("tablinks"),i=0;i<r.length;i++)r[i].className=r[i].className.replace(" active","");return document.getElementById(t).style.display="block",n.currentTarget.className+=" active",0}function sendbutton(n){var t="/command?"+n;return request=new XMLHttpRequest,request.open("GET",t,!1),request.send(),request.status!=200&&alert(request.status+": "+request.statusText),0}function set_program(){request=new XMLHttpRequest;request.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var n=this.responseText;n!="OK"&&(document.getElementById("WProgram").value=n,alert("Ok"))}};request.open("POST","/program",!1);let n=new FormData(document.forms.setupform);return request.send(n),request.status!=200&&alert(request.status+": "+request.statusText),0}function loadFile(n){var i=n,t=new FileReader;t.onload=function(){var n=JSON.parse(t.result);mapJson(n)};t.readAsText(i,"UTF-8")}function mapJson(n){for(var t=Array.prototype.slice.call(document.querySelectorAll("form input, form select")),i=0;i<t.length;i++)t[i].name==="StepperStepMl"&&t.splice(i,1);Object.keys(n).map(function(i){t.map(function(t){return t.name===i&&t.type=="checkbox"?(t.checked=n[i],!0):t.name===i?t.value=n[i]:!1})})}function SaveFormToFile(){var t,i,n;t="samovarbackup.txt";i=document.querySelector("form").serialize();n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(i));n.setAttribute("download",t);n.style.display="none";document.body.appendChild(n);n.click();document.body.removeChild(n)}HTMLElement.prototype.serialize=function(){for(var i={},r=this.querySelectorAll("input[type='text'], input[type='color'], input[type='checkbox'], select"),t=0;t<r.length;++t){var n=r[t],u=n.name,f=n.value;n.type=="checkbox"&&(f=n.checked);u&&(i[u]=f)}return JSON.stringify(i)}</script></head><body><form action=/save method=post name=setupform id=setupform><h1>Настройки</h1><div class=tab><input type=button class="tablinks active" onclick="openTab(event, 'Main');" value=Основные /><input type=button class=tablinks onclick="openTab(event, 'Temp');" value=Температура /><input type=button class=tablinks onclick="openTab(event, 'Pump');" value=Насос /><input type=button class=tablinks onclick="openTab(event, 'Beer');" value=Пиво /><input type=button class=tablinks onclick="openTab(event, 'Other');" value=Прочие /></div><div id=Main class=tabcontent style="display: block;"><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><h2><div>Режим работы<select name=mode><option value=0 %rect%>Ректификация</option><option value=1 %dist%>Дистилляция</option><option value=2 %beer%>Пиво</option><option value=3 %bk%>Бражная колонна</option></select></div></h2><h2>Ректификация и дистилляция до температуры в кубе: <input name=DistTemp type=text value=%DistTemp% />°C</h2><h2><input id=usepressure type=checkbox name=usepressure value=usepressure %checked% /><label for=usepressure>Использовать корректировку давления</label></h2></div><div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><h2>При выходе за уставки температур пара и царги при отборе тела</h2><h2><input id=useautospeed type=checkbox name=useautospeed value=useautospeed %uaschecked% /><label for=useautospeed class=tooltip>Использовать корректировку скорости насоса<span class=tooltiptext>для снижения скорости отбора при повышении температуры по пару</span></label></h2><h2>Процент корректировки: <input name=autospeed type=text value=%autospeed% />%</h2><h2><input id=useautopowerdown type=checkbox name=useautopowerdown value=useautopowerdown %uapchecked% /><label for=useautopowerdown class=tooltip>Использовать корректировку подаваемой мощности<span class=tooltiptext>при при повышении температуры по пару (работает вместе с корректировкой скорости)</span></label></h2></div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><h2>Настройки зуммера</h2><h2><input id=UseBuzzer type=checkbox name=UseBuzzer value=UseBuzzer %cubuzz% /><label for=UseBuzzer class=tooltip>Использовать зуммер для нотификации<span class=tooltiptext>при выключенном параметре зуммер отключается полностью</span></label></h2><h2><input id=UseBBuzzer type=checkbox name=UseBBuzzer value=UseBBuzzer %cubbuzz% /><label for=UseBBuzzer class=tooltip>Использовать зуммер для нотификации в браузере<span class=tooltiptext>при выключенном параметре зуммер в браузере не используется</span></label></h2><h2><input id=ChangeProgramBuzzer type=checkbox name=ChangeProgramBuzzer value=ChangeProgramBuzzer %cpbuzz% /><label for=ChangeProgramBuzzer class=tooltip>Включать зуммер при смене программы<span class=tooltiptext>для нотификации</span></label></h2></div></div><div style="border: 1px dashed #bbb; display: flex; margin-bottom: 1em;  margin-top: 1em; padding: 1em; justify-content: center;"><input id=selftest type=button name=selftest value=Самотестирование onclick='sendbutton("startst")' class=button title="Включится насос (или откроется клапан) воды, запустится перистальтический насос отбора, сервопривод перейдет по 5 позициям." /></div></div><div id=Temp class=tabcontent><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><div style="color: %SteamColor%;"><h2><div>Адрес датчика пара перед дефлегматором<select name=SteamAddr> %SteamAddr%</select></div></h2><h2>Корректировка датчика пара перед дефлегматором: <input name=DeltaSteamTemp type=text value=%DeltaSteamTemp% />°C</h2><h2>Вылет за уставку датчика пара перед дефлегматором: <input name=SetSteamTemp type=text value=%SetSteamTemp% />°C</h2><h2>Задержка отбора при выходе Т пара за уставку:<input name=SteamDelay type=text value=%SteamDelay% /> сек</h2></div></div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><div style="color: %PipeColor%;"><h2><div>Адрес датчика в царге<select name=PipeAddr> %PipeAddr%</select></div></h2><h2>Корректировка датчика в царге на 2/3 колонны: <input name=DeltaPipeTemp type=text value=%DeltaPipeTemp% />°C</h2><h2>Вылет за уставку датчика в царге на 2/3 колонны: <input name=SetPipeTemp type=text value=%SetPipeTemp% />°C</h2><h2>Задержка отбора при выходе Т в царге за уставку:<input name=PipeDelay type=text value=%PipeDelay% /> сек</h2></div></div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><div style="color: %WaterColor%;"><h2><div>Адрес датчика воды<select name=WaterAddr> %WaterAddr%</select></div></h2><h2>Корректировка датчика воды: <input name=DeltaWaterTemp type=text value=%DeltaWaterTemp% />°C</h2><h2>Уставка датчика воды: <input name=SetWaterTemp type=text value=%SetWaterTemp% />°C</h2><h2>Задержка срабатывания при выходе Т воды за уставку:<input name=WaterDelay type=text value=%WaterDelay% /> сек</h2></div></div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><div style="color: %TankColor%;"><h2><div>Адрес датчика в кубе<select name=TankAddr> %TankAddr%</select></div></h2><h2>Корректировка датчика в кубе: <input name=DeltaTankTemp type=text value=%DeltaTankTemp% />°C</h2><h2>Вылет за уставку датчика в кубе: <input name=SetTankTemp type=text value=%SetTankTemp% />°C</h2><h2>Задержка срабатывания при выходе Т в кубе за уставку:<input name=TankDelay type=text value=%TankDelay% /> сек</h2></div></div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><div style="color: %ACPColor%;"><h2><div>Адрес датчика в ТСА<select name=ACPAddr> %ACPAddr%</select></div></h2><h2>Корректировка датчика в ТСА <input name=DeltaACPTemp type=text value=%DeltaACPTemp% />°C</h2><h2>Вылет за уставку датчика в ТСА: <input name=SetACPTemp type=text value=%SetACPTemp% />°C</h2><h2>Задержка срабатывания при выходе Т в ТСА за уставку:<input name=ACPDelay type=text value=%ACPDelay% /> сек</h2></div></div></div><div id=Pump class=tabcontent><h2>Количество шагов шагового двигателя:<input name=StepperStepMl type=text value=%StepperStepMl% style="width: 6em;" /> /мл.</h2><div style="margin: 0 auto; width: 200px;"><input id=setstvolume type=button name=return value="Калибровка насоса" onclick='javascript:location.href="/calibrate.htm"' class=button /></div></div><div id=Beer class=tabcontent><h2>Коэффициенты для PID регулятора нагрева:</h2><h2>Kp:<input name=Kp type=text value=%Kp% /></h2><h2>Ki:<input name=Ki type=text value=%Ki% /></h2><h2>Kd:<input name=Kd type=text value=%Kd% /></h2><div id=VoltH2><h2>Напр. регулятора в режиме поддержания темп.:<input name=StbVoltage id=StbVoltage type=text value=%StbVoltage% /> V</h2></div></div><div id=Other class=tabcontent><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><h2>Токен Blynk:<input name=blynkauth type=text size=32 style="width: 22em;" value=%blynkauth% /></h2><h2>URL видео камеры:<input name=videourl type=text size=32 style="width: 30em;" value=%videourl% /></h2><h2>Часовой пояс:<input name=TimeZone type=text value=%TimeZone% /></h2><h2><input id=CheckPower type=checkbox name=CheckPower value=CheckPower %chckpwr% /><label for=CheckPower class=tooltip>Использовать проверку подключения регулятора<span class=tooltiptext>Если используется регулятор, при отсутствии связи с ним Самовар выключит питание</span></label></h2><h2>Сопротивление тэна для расчета мощности:<input name=HeaterR type=text value=%HeaterR% /> Ом</h2><h2>Периодичность записи данных в лог:<input name=LogPeriod type=text value=%LogPeriod% /> сек</h2></div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><h2><p>Цвета для температур:</p><div><input type=color id=SteamColor name=SteamColor value=%SteamColor% /><label for=SteamColor>Температура пара</label></div><div><input type=color id=PipeColor name=PipeColor value=%PipeColor% /><label for=PipeColor>Температура датчика в царге</label></div><div><input type=color id=WaterColor name=WaterColor value=%WaterColor% /><label for=WaterColor>Температура воды</label></div><div><input type=color id=TankColor name=TankColor value=%TankColor% /><label for=TankColor>Температура датчика в кубе</label></div><div><input type=color id=ACPColor name=ACPColor value=%ACPColor% /><label for=ACPColor>Температура датчика в ТСА</label></div></h2><p><a href=https://www.w3schools.com/colors/colors_picker.asp target=blank>цвета можно подобрать тут</a></p></div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding-left: 2em; justify-content: space-between;"><h2>Настройки уровней для реле<div> Реле 1<select name=rele1><option value=0 %ral%>LOW</option><option value=1 %rah%>HIGH</option></select></div><div>Реле 2<select name=rele2><option value=0 %rbl%>LOW</option><option value=1 %rbh%>HIGH</option></select></div><div>Реле 3<select name=rele3><option value=0 %rcl%>LOW</option><option value=1 %rch%>HIGH</option></select></div><div>Реле 4<select name=rele4><option value=0 %rdl%>LOW</option><option value=1 %rdh%>HIGH</option></select></div></h2></div><div style="border: 1px dashed #bbb; margin-bottom: 1em; padding: 1em 2em 1em 2em; justify-content: space-between;"><div class=container_column style="margin-bottom: 1em;"><div class=container_row style="justify-content: space-around; align-items: center;"><div><input id=saveform type=button name=saveform value="Сохранить настройки" onclick=SaveFormToFile(this); class=button /></div><div><input id=resetwifi type=button name=resetwifi value="Сбросить настройки WiFI" onclick='sendbutton("resetwifi=1");' class=button /></div></div><div class=container_row style="justify-content: space-around; align-items: center;"><div><label for=fileToLoad class="button custom-file-upload" style="margin-left: 0px !important;"><i class="fa fa-cloud-upload"></i> Восстановить настройки</label><input type=file id=fileToLoad accept=text/plain onchange=loadFile(this.files[0]) class=button /></div><div><input id=reboot type=button name=reboot value="Перезагрузить Самовар" onclick='sendbutton("reboot");' class=button /></div></div></div></div></div><div style="margin: 0 auto; width: 668px;"><input id=save type=submit name=save value=Сохранить class=button /><input id=return type=button name=return value="На главную" onclick='javascript:location.href="/index.htm"' class=button /><input id=edit type=button name=edit value=Редактор onclick='javascript:location.href="/edit"' class=button /></div></form></body></html>