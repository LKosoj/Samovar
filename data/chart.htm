<html><head><meta charset=utf-8 /><meta http-equiv=Cache-Control content=no-cache /><link rel="shortcut icon" href=/favicon.ico type=image/x-icon /><link rel=stylesheet href=/style.css /><title>Самовар</title><script src=https://cdn.amcharts.com/lib/4/core.js></script><script src=https://cdn.amcharts.com/lib/4/charts.js></script><script src=https://cdn.amcharts.com/lib/4/themes/animated.js></script><script>function ConnectError(n){n?OfflineCouner?(document.getElementById("GreenT").style="visibility: hidden;position: fixed;",document.getElementById("RedT").style="",addMessage("Обрыв связи!",0),setTimeout(()=>{IsOffline=!0,OfflineCouner=0},100)):OfflineCouner++:(document.getElementById("GreenT").style="",document.getElementById("RedT").style="visibility: hidden;position: fixed;",IsOffline=!1,OfflineCouner=0)}function setPowerUnit(){let t,i,r,u,n;pwr_unit==="P"?(t="Мощность регулятора: ",i="Установить мощность",r="Текущая мощн.: ",u="Целевая мощн.: ",n=" Вт",document.getElementById("current_power_line").style="visibility: hidden",document.getElementById("PWR").style=""):pwr_unit==="V"?(t="Напряжение регулятора: ",i="Установить напряжение",r="Текущее напр.: ",u="Целевое напр.: ",n=" V",document.getElementById("current_power_line").style="visibility: visible",document.getElementById("PWR").style=""):document.getElementById("PWR").style="visibility: hidden;position: fixed;";document.getElementById("set_power_label").innerHTML=t;document.getElementById("SetVoltage").value=i;document.getElementById("power_current").innerHTML=r;document.getElementById("power_target").innerHTML=u;document.getElementById("power_unit_current").innerHTML=n;document.getElementById("power_unit_target").innerHTML=n}function AddLuaButtons(){let n="%btn_list%";if(n!==""){let t=n.split(",");for(z=0;z<t.length;z++)if(t[z]!==""){let i=t[z].split("|"),n=document.createElement("input");n.type="submit";n.name="luabtn"+z;n.value=i[1];n.className="button";n.setAttribute("onclick",'run_lua("'+i[0]+'");');document.getElementById("lua_btn_ln").appendChild(n);document.getElementById("lua_btn").style="visibility: visible"}}}function playSound(n){!sound_is_playing&&n?(sound.play(),sound_is_playing=!0):sound_is_playing&&!n&&(sound.pause(),sound_is_playing=!1)}function addMessage(n,t){if(!IsOffline){let r=(new Date).toLocaleTimeString("ru-RU"),i=null;switch(t){case 0:i="message_0";is_ALARM=!0;break;case 1:i="message_1";break;case 2:i="message_2";break;default:i="message_0";is_ALARM=!0}let u=`
            <div align="left" class=${i} onclick=removeLastMessage() style="cursor: pointer">
              ${r}  ${n}
            </div>`;if(Messages_Array.push(u),Messages_Array.length>1){previousMsg=Messages_Array[Messages_Array.length-2];let n=previousMsg.replace('onclick=removeLastMessage() style="cursor: pointer"',"");Messages_Array[Messages_Array.length-2]=n}showMessages()}}function removeLastMessage(){if(Messages_Array.pop(),Messages_Array.length>0){lastMsg=Messages_Array[Messages_Array.length-1];let n=lastMsg.replace('<div align="left"','<div align="left" onclick=removeLastMessage() style="cursor: pointer"');Messages_Array[Messages_Array.length-1]=n}else is_ALARM=!1,IsCalmingPause=!1;showMessages()}function showMessages(){if(Messages_Array.length>0){let n=[];document.getElementById("messages").innerHTML="";Messages_Array.forEach(t=>{document.getElementById("messages").innerHTML+=t,n.push(t.includes("class=message_0"))});document.getElementById("messagesBox").style.display="block";let t=document.getElementById("messagesBox");t.scrollTop=t.scrollHeight;function i(n){return n===!0}is_ALARM=n.some(i);sound_is_on&is_ALARM?playSound(!0):playSound(!1)}else document.getElementById("messagesBox").style.display="none",playSound(!1)}function clearMessages(){Messages_Array=[];showMessages()}function loadDoc(){var n=new XMLHttpRequest;n.timeout=4e3;n.onreadystatechange=function(){var n,t;if(this.readyState==4&&this.status==200){ConnectError(!1);n=JSON.parse(this.responseText);document.getElementById("crnt_tm").innerHTML=n.crnt_tm;document.getElementById("stm").innerHTML=n.stm;document.getElementById("SteamTemp").innerHTML=n.SteamTemp.toFixed(3);document.getElementById("PipeTemp").innerHTML=n.PipeTemp.toFixed(3);document.getElementById("WaterTemp").innerHTML=n.WaterTemp.toFixed(3);document.getElementById("TankTemp").innerHTML=n.TankTemp.toFixed(3);document.getElementById("ACPTemp").innerHTML=n.ACPTemp.toFixed(3);document.getElementById("VolumeAll").innerHTML=n.VolumeAll;document.getElementById("ActualVolumePerHour").innerHTML=n.ActualVolumePerHour;document.getElementById("WthdrwlProgress").innerHTML=n.WthdrwlProgress;n.PrgType?n.PrgType==="P"?n.PrgType="Пауза":n.PrgType==="H"?n.PrgType="Головы":n.PrgType==="B"?n.PrgType="Тело":n.PrgType==="C"?n.PrgType="Предзахлеб":n.PrgType==="T"&&(n.PrgType="Хвосты"):n.PrgType="";document.getElementById("Status").innerHTML=n.Status+"; "+n.PrgType;document.getElementById("bme_temp").innerHTML=n.bme_temp;document.getElementById("heap").innerHTML=n.heap;document.getElementById("rssi").innerHTML=n.rssi;document.getElementById("fr_bt").innerHTML=n.fr_bt;sound_is_on=!!n.UseBBuzzer;t=n.PipeTemp-n.SteamTemp;document.getElementById("DeltaTemp").innerHTML=t.toFixed(3);let i=n.Status;i&&i!==""&&i.includes("Продолжение через")&&!IsCalmingPause&&(addMessage(i,1),IsCalmingPause=!0);n.Msg&&n.Msg!==""&&addMessage(n.Msg,n.msglvl)}};n.onerror=function(){ConnectError(!0)};n.ontimeout=function(){ConnectError(!0)};n.open("GET","/ajax",!0);n.send()}function refresh_chart(){chart.dataSource.reloadFrequency=document.getElementById("refresh").checked?15e3:null;chart.dataSource.load()}var IsOffline=!1,OfflineCouner=0,IsOffline=!1,sound_is_on=!0,IsCalmingPause=!1,Messages_Array=[],sound_is_playing=!1,is_ALARM=!1,chart;const sound=new Audio("alarm.mp3");sound.loop=!0;sound.preload="auto";sound.autoplay=!1;setInterval(loadDoc,2e3);am4core.ready(function(){var e,i,r,u,n,t;am4core.useTheme(am4themes_animated);chart=am4core.create("chartdiv",am4charts.XYChart);chart.colors.list=[am4core.color("%SteamColor%"),am4core.color("%PipeColor%"),am4core.color("%WaterColor%"),am4core.color("%TankColor%"),am4core.color("#3EFF42"),am4core.color("#000000")];chart.dataSource.url="/data.csv";chart.dataSource.disableCache=!0;chart.dataSource.parser=new am4core.CSVParser;chart.dataSource.parser.options.useColumnNames=!0;chart.dataSource.parser.options.emptyAs="empty";chart.dataSource.reloadFrequency=15e3;e=chart.xAxes.push(new am4charts.CategoryAxis);e.dataFields.category="Date";var h=chart.yAxes.push(new am4charts.ValueAxis),o=chart.yAxes.push(new am4charts.ValueAxis),s=chart.yAxes.push(new am4charts.ValueAxis),f=chart.series.push(new am4charts.LineSeries);f.dataFields.valueY="Steam";f.dataFields.categoryX="Date";f.name="Температура пара";f.strokeWidth=3;f.tensionX=.7;f.tooltipText="{valueY.value}";f.hidden=%SteamHide%;i=chart.series.push(new am4charts.LineSeries);i.dataFields.valueY="Pipe";i.dataFields.categoryX="Date";i.name="Температура в царге";i.strokeWidth=3;i.tensionX=.7;i.tooltipText="{valueY.value}";i.hidden=%PipeHide%;r=chart.series.push(new am4charts.LineSeries);r.dataFields.valueY="Water";r.dataFields.categoryX="Date";r.name="Температура воды";r.strokeWidth=3;r.tensionX=.7;r.tooltipText="{valueY.value}";r.hidden=%WaterHide%;u=chart.series.push(new am4charts.LineSeries);u.dataFields.valueY="Tank";u.dataFields.categoryX="Date";u.name="Температура в кубе";u.strokeWidth=3;u.tensionX=.7;u.tooltipText="{valueY.value}";u.hidden=%TankHide%;n=chart.series.push(new am4charts.LineSeries);n.yAxis=o;n.dataFields.valueY="Pressure";n.dataFields.categoryX="Date";n.name="Атмосферное давление";n.strokeWidth=2;n.tensionX=.7;n.tooltipText="{valueY.value}";n.hidden=%PressureHide%;t=chart.series.push(new am4charts.LineSeries);t.yAxis=s;t.dataFields.valueY="ProgNum";t.dataFields.categoryX="Date";t.name="Строка программы";t.strokeWidth=1;t.tensionX=.7;t.tooltipText="{valueY.value}";t.hidden=%ProgNumHide%;chart.scrollbarX=new am4core.Scrollbar;chart.cursor=new am4charts.XYCursor;chart.cursor.xAxis=e;chart.legend=new am4charts.Legend})</script></head><body><div style="position: absolute; top: 1em; left: 20%; width: 60%;"><div class=messages_box style="display: none;" id=messagesBox><div style="position: absolute; height: 0.6em; top: 0; right: 0.5em; cursor: pointer" onclick=clearMessages()>[x] очистить</div><div class=messages_array id=messages></div></div></div><div id=chartdiv></div><form action=none onsubmit="return false"><h1>Статус</h1><h2><input id=refresh type=checkbox name=refresh value=refresh checked=checked onclick=refresh_chart() /><label for=refresh>Обновлять график</label></h2><div class=message-box style="display: none;" id=message></div><div class=container_row style="justify-content: space-between; font-size: 0.7em;"><div class=text>Текущее время: <span id=crnt_tm></span></div><div class=text id=GreenT><img src=Green.png width=20 /></div><div class=text id=RedT style="visibility: hidden;position: fixed;"><img src=Red_light.gif width=20 /></div><div class=text>Время работы: <span id=stm></span></div></div><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em;"><div class=container_column style="flex: 1.1; padding-left: 2em;"><div class=text style="color: %PipeColor%;">Т в царге:    <span id=PipeTemp style="font-size: xx-large;"></span> °C</div><div class=text style="color: %SteamColor%;">Т пара:    <span id=SteamTemp style="font-size: xx-large;"></span> °C</div><div class=text style="color: black;">Δ температур:   <span id=DeltaTemp style="font-size: xx-large;"></span> °C</div></div><div class=container_column style="flex: 1; align-items: flex-end; padding-right: 2em;"><div class=text style="color: %WaterColor%;">Т воды:    <span id=WaterTemp style="font-size: xx-large;"></span> °C</div><div class=text style="color: %TankColor%;">Т в кубе:    <span id=TankTemp style="font-size: xx-large;"></span> °C</div><div class=text style="color: %ACPColor%;">Т в ТСА:    <span id=ACPTemp style="font-size: xx-large;"></span> °C</div></div></div><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em; justify-content: space-between;"><div class=container_column style="flex: 1.1; padding-left: 2em;"><div class=text>Скорость отбора:   <span id=ActualVolumePerHour></span> л/ч</div><div class=text>Отобранный объем:   <span id=VolumeAll></span> мл</div></div><div class=container_column style="flex: 1; align-items: flex-end; padding-right: 2em;"><div class=text>Прогресс отбора:   <span id=WthdrwlProgress></span> %</div></div></div><div class=container><div class=text><span>Статус: <span id=Status></span></span></div></div><input id=return type=button name=return value=Назад onclick='javascript:location.href="/index.htm"' class=button /><input id=getlog type=button name=getlog value="Сохранить лог" onclick='javascript:window.open("/getlog")' class=button /><input id=getoldlog type=button name=getoldlog value="Сохранить старый лог" onclick='javascript:window.open("/getoldlog")' class=button /><div class=dvcs><div><span class=dvcs>Системные параметры: Heap=<span id=heap></span>; BME temp=<span id=bme_temp></span>; RSSI = <span id=rssi></span>; Свободно: <span id=fr_bt></span></span></div></div></form></body></html>