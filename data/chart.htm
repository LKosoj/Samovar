<html>
<head>
<meta charset='utf-8'>
<title>Самовар</title>
</head>
<style>
#chartdiv {
  width: 100%;
  height: 500px;
  background:#fff;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
#file-input,input{width:200;height:34px;border-radius:4px;margin:10 10 0 10;font-size:15px}
input{background:#f1f1f1;border:0;padding:0 15px;}
input[type='checkbox']{width:20;margin:0}
input[type='text']{background:#f1f1f1;border:0;padding:0 15px;width:80;margin:0}
#file-input{padding:0;border:1px solid #ddd;line-height:44px;text-align:left;display:block;cursor:pointer}
body{background:#3498db;font-family:sans-serif;font-size:14px;color:#777}
#bar,#prgbar{background-color:#f1f1f1;border-radius:10px}#bar{background-color:#3498db;width:0;height:10px}
form{background:#fff;max-width:800px;margin:25px auto;padding:30px;border-radius:5px;text-align:left}
h1{text-align:center}
.btn{background:#3498db;color:#fff;cursor:pointer}
.dvcs{padding: 10px;margin: 10px;}
input[type="checkbox"]:checked, 
input[type="checkbox"]:not(:checked), 
input[type="radio"]:checked, 
input[type="radio"]:not(:checked) 
{
    position: absolute;
    left: -9999px;
}

input[type="checkbox"]:checked + label, 
input[type="checkbox"]:not(:checked) + label, 
input[type="radio"]:checked + label, 
input[type="radio"]:not(:checked) + label {
    display: inline-block;
    position: relative;
    padding-left: 28px;
    line-height: 20px;
    cursor: pointer;
}
input[type="checkbox"]:checked + label:before, 
input[type="checkbox"]:not(:checked) + label:before,
input[type="radio"]:checked + label:before, 
input[type="radio"]:not(:checked) + label:before {
    content: "";
    position: absolute;
    left: 0px;
    top: 0px;
    width: 18px;
    height: 18px;
    border: 1px solid #dddddd;
    background-color: #ffffff;
}

input[type="checkbox"]:checked + label:before, 
input[type="checkbox"]:not(:checked) + label:before {
    border-radius: 2px;
}
input[type="checkbox"]:checked + label:after, 
input[type="checkbox"]:not(:checked) + label:after, 
input[type="radio"]:checked + label:after, 
input[type="radio"]:not(:checked) + label:after {
    content: "";
    position: absolute;
    -webkit-transition: all 0.2s ease;
    -moz-transition: all 0.2s ease;
    -o-transition: all 0.2s ease;
    transition: all 0.2s ease;
}

input[type="checkbox"]:checked + label:after, 
input[type="checkbox"]:not(:checked) + label:after {
    left: 3px;
    top: 4px;
    width: 10px;
    height: 5px;
    border-radius: 1px;
    border-left: 4px solid #3498db;
    border-bottom: 4px solid #3498db;
    -webkit-transform: rotate(-45deg);
    -moz-transform: rotate(-45deg);
    -o-transform: rotate(-45deg);
    -ms-transform: rotate(-45deg);
    transform: rotate(-45deg);
}

input[type="radio"]:checked + label:after, 
input[type="radio"]:not(:checked) + label:after {
    left: 5px;
    top: 5px;
    width: 10px;
    height: 10px;
    border-radius: 100%;
    background-color: #3498db;
}
input[type="checkbox"]:not(:checked) + label:after, 
input[type="radio"]:not(:checked) + label:after {
    opacity: 0;
}

input[type="checkbox"]:checked + label:after, 
input[type="radio"]:checked + label:after {
    opacity: 1;
}
</style>

<script src="https://cdn.amcharts.com/lib/4/core.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

<!-- Chart code -->
<script>
var chart;
setInterval(loadDoc,2000);
function loadDoc() {
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
var myObj = JSON.parse(this.responseText);
document.getElementById('crnt_tm').innerHTML = myObj.crnt_tm;
document.getElementById('stm').innerHTML = myObj.stm;
document.getElementById('SteamTemp').innerHTML = myObj.SteamTemp;
document.getElementById('PipeTemp').innerHTML = myObj.PipeTemp;
document.getElementById('WaterTemp').innerHTML = myObj.WaterTemp;
document.getElementById('TankTemp').innerHTML = myObj.TankTemp;
document.getElementById('VolumeAll').innerHTML = myObj.VolumeAll;
document.getElementById('ActualVolumePerHour').innerHTML = myObj.ActualVolumePerHour;
document.getElementById('WthdrwlProgress').innerHTML = myObj.WthdrwlProgress;
document.getElementById('CurrrentSpeed').innerHTML = myObj.CurrrentSpeed;
}
};
xhttp.open("GET", "/ajax", true);
xhttp.send();
};

am4core.ready(function() {
// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end
chart = am4core.create("chartdiv", am4charts.XYChart);

chart.colors.list = [
  am4core.color("#FF0000"),
  am4core.color("#191970"),
  am4core.color("#00BFFF"),
  am4core.color("#000000"),
  am4core.color("#21618C")
];

chart.dataSource.url = "/data.csv";
chart.dataSource.parser = new am4core.CSVParser();
chart.dataSource.parser.options.useColumnNames = true;
//chart.dataSource.updateCurrentData = true;
chart.dataSource.reloadFrequency = 15000;
// Create axes
var dateAxis = chart.xAxes.push(new am4charts.CategoryAxis());
dateAxis.dataFields.category = "Date";
// Create value axis
var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
var valueAxis1 = chart.yAxes.push(new am4charts.ValueAxis());
// Create series
var series1 = chart.series.push(new am4charts.LineSeries());
series1.dataFields.valueY = "Steam";
series1.dataFields.categoryX = "Date";
series1.name = "Температура пара";
series1.strokeWidth = 3;
series1.tensionX = 0.7;
//series1.bullets.push(new am4charts.CircleBullet());

var series2 = chart.series.push(new am4charts.LineSeries());
series2.dataFields.valueY = "Pipe";
series2.dataFields.categoryX = "Date";
series2.name = "Температура в царге";
series2.strokeWidth = 3;
series2.tensionX = 0.7;
//series2.bullets.push(new am4charts.CircleBullet());

var series3 = chart.series.push(new am4charts.LineSeries());
series3.dataFields.valueY = "Water";
series3.dataFields.categoryX = "Date";
series3.name = "Температура воды";
series3.strokeWidth = 3;
series3.tensionX = 0.7;
//series3.bullets.push(new am4charts.CircleBullet());

var series4 = chart.series.push(new am4charts.LineSeries());
series4.dataFields.valueY = "Tank";
series4.dataFields.categoryX = "Date";
series4.name = "Температура в кубе";
series4.strokeWidth = 3;
series4.tensionX = 0.7;
//series4.bullets.push(new am4charts.CircleBullet());

var series5 = chart.series.push(new am4charts.LineSeries());
series5.yAxis = valueAxis1;
series5.dataFields.valueY = "Pressure";
series5.dataFields.categoryX = "Date";
series5.name = "Атмосферное давление";
series5.strokeWidth = 3;
series5.tensionX = 0.7;

//chart.cursor = new am4charts.XYCursor();
//chart.cursor.snapToSeries = series1;
//chart.cursor.xAxis = dateAxis;

////chart.scrollbarY = new am4core.Scrollbar();
chart.scrollbarX = new am4core.Scrollbar();

// Add legend
chart.legend = new am4charts.Legend();
});

function refresh_chart(){
  if (!document.getElementById('refresh').checked) chart.dataSource.reloadFrequency = null;
  else chart.dataSource.reloadFrequency = 15000;
  chart.dataSource.load();
};
</script>
<body>
<div id="chartdiv"></div>
<form action='none' onsubmit='return false'>
<h1>Статус</h1>
<h2><input id='refresh' type='checkbox' name='refresh' value='refresh' checked='checked' onclick='refresh_chart()'><label for='refresh'>Обновлять график</label></h2></h2>
<h2>Текущее время: <span id='crnt_tm'></span></h2>
<h2>Время работы Samovar: <span id='stm'></span></h2>
<h2>Температура пара перед дефлегматором: <span id='SteamTemp'></span>&#176C</h2>
<h2>Температура пара в царге на 2/3 колонны: <span id='PipeTemp'></span>&#176C</h2>
<h2>Температура флегмы или воды: <span id='WaterTemp'></span>&#176C</h2>
<h2>Температура в кубе: <span id='TankTemp'></span>&#176C</h2>
<h2>Отобранный объем: <span id='VolumeAll'></span> мл</h2>
<h2>Скорость отбора: <span id='ActualVolumePerHour'></span> л/ч</h2>
<h2>Скорость шагового двигателя: <span id='CurrrentSpeed'></span> об/сек</h2>
<h2>Прогресс отбора: <span id='WthdrwlProgress'></span>%</h2>
<input id='return' type='button' name='return' value='Назад' onclick='javascript:location.href="/index.htm"'>
<input id='getlog' type='button' name='getlog' value='Сохранить лог' onclick='javascript:window.open("/getlog")'>
</form>
</body>
</html>