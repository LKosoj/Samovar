<html><head><meta charset=utf-8 /><meta http-equiv=Cache-Control content=no-cache /><link rel="shortcut icon" href=/favicon.ico type=image/x-icon /><link rel=stylesheet href=/style.css /><title>Самовар</title><script>function loadFile(n){var i=n,t=new FileReader;t.onload=function(){document.getElementById("WProgram1").value=t.result;glcalcnum=!1;calc_program()};t.readAsText(i,"UTF-8")}function getProgramFromFile(n){var i=n.value,t;i==0?t="/program_fruit.txt":i==1?t="/program_grain.txt":i==2&&(t="/program_shugar.txt");fetch(t).then(n=>n.text()).then(n=>{document.getElementById("WProgram1").value=n,glcalcnum=!1,calc_program()})}function SaveProgramToFile(){var t,i,n;t="programbackup.txt";i=document.getElementById("WProgram1").value;n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(i));n.setAttribute("download",t);n.style.display="none";document.body.appendChild(n);n.click();document.body.removeChild(n)}function openTab(n,t){for(var r,u=document.getElementsByClassName("tabcontent"),i=0;i<u.length;i++)u[i].style.display="none";for(r=document.getElementsByClassName("tablinks"),i=0;i<r.length;i++)r[i].className=r[i].className.replace(" active","");return document.getElementById(t).style.display="block",n.currentTarget.className+=" active",0}function check_program(n){var r=n.split("\n"),u=0,f=!0,t,e;for(i=0;i<r.length;i++)e=r[i].split(";"),t=e.length,t==1&&e[0]!=""&&r.length==i-1?f=!1:u>0&&t>1&&u!=t&&(f=!1),u=t;return f}function get_time(n){var t="";return l=Math.trunc(n),l<10&&(t="0"),t=t+l+":",l=Math.trunc((n-Math.trunc(n))*60),l<10&&(t=t+"0"),t+l}function set_num(){var f,h;prep_calc();programerr=!1;var n=document.getElementById("prg").childNodes,r,u,l,c=0,o=0,s=0,t="",e="";for(i=1;i<n.length;i++)r=n[i].childNodes[0],r.innerText="",i<10&&(r.innerText="0"),r.innerText=r.innerText+i,n[i].childNodes[3].value.indexOf(".")>0&&(n[i].childNodes[3].value=n[i].childNodes[3].value.substring(0,n[i].childNodes[3].value.indexOf("."))),n[i].childNodes[3].value.indexOf(",")>0&&(n[i].childNodes[3].value=n[i].childNodes[3].value.substring(0,n[i].childNodes[3].value.indexOf(","))),n[i].childNodes[2].value=n[i].childNodes[2].value.replace(",","."),n[i].childNodes[5].value=n[i].childNodes[5].value.replace(",","."),u=n[i].childNodes[6],l=n[i].childNodes[7],f=1,n[i].childNodes[4].value=="H"?(f=phv/100,o=o+Number(n[i].childNodes[3].value)):n[i].childNodes[4].value=="T"?f=ptv/100:n[i].childNodes[4].value=="P"?f=1:(n[i].childNodes[4].value=="B"||n[i].childNodes[4].value=="C")&&(f=pbas/100,s=s+Number(n[i].childNodes[3].value)),ll=n[i].childNodes[3].value*f,t=t+n[i].childNodes[4].value+";",n[i].childNodes[4].value=="P"?(u.value=n[i].childNodes[2].value,r=u.value/3600,t=t+u.value):(u.value=ll.toFixed(3),r=u.value/n[i].childNodes[2].value,t=t+u.value*1e3),t=t+";"+n[i].childNodes[2].value+";"+n[i].childNodes[1].value+";0;"+n[i].childNodes[5].value+"\n",l.value=get_time(r),c=c+Number(r),e=e+n[i].childNodes[1].value+";"+n[i].childNodes[2].value+";"+n[i].childNodes[3].value+";"+n[i].childNodes[4].value+";"+n[i].childNodes[5].value+"\n";return document.getElementById("sum").value=get_time(c),h="",programerr=!1,o!=100&&(h="Ошибка в программе - объем головных фракций не равен 100 ("+o+")"),s!=100&&(h="Ошибка в программе - объем фракции тела не равен 100 ("+s+")"),h!=""&&(programerr=!0),t=t.slice(0,-1),e=e.slice(0,-1),document.getElementById("WProgram1").value=e,document.getElementById("WProgram").value=t,programerr}function prep_calc(){var i=document.getElementById("vless").value,s=document.getElementById("vlssp").value/100,n=document.getElementById("vlp").value/100,h=document.getElementById("vlhp").value/100,c=document.getElementById("vltp").value/100,t=i*s,v=t/n,u=t*h,r,a,o;phv=u/n;r=t*c;ptv=r/n*2;var f=r+u,l=ptv+phv,e=t-f;pbas=e/n;a=i-f-e;o=(i-l-pbas)*.9;document.getElementById("trest").value=o.toFixed(2)}function calc_program(){var n,i,t;for(prep_calc(),n=document.getElementById("prg");n.firstChild;)n.removeChild(n.firstChild);for(n.insertAdjacentHTML("afterbegin",'<div class="prgline" id="hdr"><label class="tooltip">№<\/label>&nbsp;&nbsp;<label class="tooltip">Емкость<span class="tooltiptext">Номер емкости (нумерация начинается от 0)<\/span><\/label><label class="tooltip">Скорость<span class="tooltiptext">Скорость в литрах в час. Для строки с типом "Пауза" - время паузы в секундах<\/span><\/label><label class="tooltip">Процент<span class="tooltiptext">Процент от объема фракции данного типа<\/span><\/label>&nbsp;&nbsp;&nbsp;<label class="tooltip">Тип<span class="tooltiptext">Тип программы. Для режима Пауза время паузы в секундах задается в поле "Скорость"<\/span><\/label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label class="tooltip">Напр<span class="tooltiptext">Напряжение или мощность на регуляторе (зависит от типа используемого регулятора)<\/span><\/label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label class="tooltip">Выход<span class="tooltiptext">Объем отбираемой фракции в данной строке программы<\/span><\/label>&nbsp;&nbsp;&nbsp;<label class="tooltip">Время<span class="tooltiptext">Время, необходимое на отбор фракции в данной строке программы<\/span><\/label><\/div>'),i=document.getElementById("WProgram1"),t=i.value.split("\n"),z=0;z<t.length;z++)addLine(!1,t[z]);glcalcnum=!0;set_num()}function set_program(){if(glcalcnum=!1,calc_program(),programerr){alert("В программе ошибка! Программа не установлена");return}request=new XMLHttpRequest;request.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var n=this.responseText;n!="OK"&&(document.getElementById("WProgram").value=n,alert("Ok"))}};request.open("POST","/program",!1);let n=new FormData(document.forms.mainform);return request.send(n),request.status!=200&&alert(request.status+": "+request.statusText),0}function sendbutton(n){var t="/command?"+n;return request=new XMLHttpRequest,request.open("GET",t,!1),request.send(),request.status!=200&&alert(request.status+": "+request.statusText),sleep(1e3),0}function removeLine(n){var i=document.getElementById("prg").childNodes.length,t;i<3||(t=document.getElementById(n),t.remove(),set_num())}function addLine(n,t){var y=!1,u,i,a,f,r,e,s,h,c,l,v,o,p,w;if(n&&t==""){var o=document.getElementById(n).childNodes;t=o[1].value+";"+o[2].value+";0;"+o[4].value+";0";y=!0}u=t.split(";");i=document.createElement("div");i.className="prgline";i.id="prgln"+_lnIdx;a=document.createElement("label");a.className="prglabel";i.appendChild(a);a.insertAdjacentHTML("afterend",'<select id="pnum'+_lnIdx+'" name="pnum'+_lnIdx+'"><option value="0">0<\/option><option value="1">1<\/option><option value="2">2<\/option><option value="3">3<\/option><option value="4">4<\/option><option value="5">5<\/option><option value="6">6<\/option><option value="7">7<\/option><option value="8">8<\/option><option value="9">9<\/option><option value="10">10<\/option><\/select>');f=document.createElement("input");f.type="text";f.name="speed"+_lnIdx;f.value=u[1];f.setAttribute("onchange","set_num();");i.appendChild(f);r=document.createElement("input");r.type="text";r.name="percent"+_lnIdx;r.value=u[2];r.setAttribute("onchange","set_num();");i.appendChild(r);r.insertAdjacentHTML("afterend",'<select id="ptype'+_lnIdx+'" name="ptype'+_lnIdx+'" onchange="set_bgcolor('+_lnIdx+')"><option value="H">Головы<\/option><option value="B">Тело<\/option><option value="C">Предзахлеб<\/option><option value="T">Хвосты<\/option><option value="P">Пауза<\/option><\/select>');e=document.createElement("input");e.type="text";e.name="pvolt"+_lnIdx;e.value=u[4];e.setAttribute("onchange","set_num();");i.appendChild(e);s=document.createElement("input");s.type="text";s.name="pvl"+_lnIdx;s.setAttribute("disabled","");i.appendChild(s);h=document.createElement("input");h.type="text";h.name="tm"+_lnIdx;h.setAttribute("disabled","");i.appendChild(h);c=document.createElement("img");c.src="/plus.png";c.setAttribute("width","20");c.setAttribute("onclick","addLine('prgln"+_lnIdx+"','')");i.appendChild(c);l=document.createElement("img");l.src="/minus.png";l.setAttribute("width","20");l.setAttribute("onclick","removeLine('prgln"+_lnIdx+"')");i.appendChild(l);n?(v=document.getElementById(n),v.after(i)):(v=document.getElementById("prg"),v.appendChild(i));o="ptype"+_lnIdx;p=document.getElementById(o);p.value=u[3];w=document.getElementById("pnum"+_lnIdx);w.value=u[0];set_bgcolor(_lnIdx);_lnIdx++;y&&set_num()}function set_bgcolor(n){var r=document.getElementById("prgln"+n),t=document.getElementById("ptype"+n).value,i;for(t=="H"?color="background-color: #80FFFA;":t=="B"?color="background-color: #32CD3229;":t=="C"?color="background-color: #FFFF0039;":t=="P"?color="background-color: #C4C4C4;":t=="T"&&(color="background-color: #8B451334;"),r.setAttribute("style",color),i=r.childNodes,q=0;q<i.length;q++)i[q].setAttribute("style",color);glcalcnum&&set_num()}var _lnIdx=0,phv=0,ptv=0,pbas=0,programerr,glcalcnum=!1;window.onload=function(){getProgramFromFile(document.getElementById("loadprogram"));return}</script></head><body><form action=none onsubmit="return false" name=mainform id=mainform><h1><div class=message-box style="display: none;" id=message></div>Samovar v. <span id=version>%v%</span></h1><div class=text>Расчет программы отбора<select id=loadprogram name=loadprogram onchange=getProgramFromFile(this)><option value=0>Фрукты</option><option value=1>Зерно</option><option value=2>Сахар</option></select></div><div class=tabcontent style="display: block;border-top: solid;border-top-width: 1px;border-top-color: rgb(204, 204, 204);"><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em;"><div id=Prog><div style="margin-bottom: 10px !important;"><label class="tooltip prgline">Объем спирта-сырца</label><input id=vless type=text value=12.25 onchange=set_num(); /><label class="tooltip prgline">л</label>     <label class="tooltip prgline">Содержание АС в с-с<span class=tooltiptext>Содержание абсолютного спирта в спирте-сырце в %</span></label><input id=vlssp type=text value=34 onchange=set_num(); /><label class="tooltip prgline">%</label>     <label class="tooltip prgline">Выход спирта<span class=tooltiptext>Прогнозируемый выход спирта в %</span></label><input id=vlp type=text value=94 onchange=set_num(); /><label class="tooltip prgline">%</label></div><div style="margin-top: 10px !important; padding-bottom: 0px !important; margin-bottom: 10px !important;"><label class="tooltip prgline">Объем голов<span class=tooltiptext>Прогнозируемый выход голов в %</span></label><input id=vlhp type=text value=8 onchange=set_num(); /><label class="tooltip prgline">%</label>     <label class="tooltip prgline">Объем хвостов<span class=tooltiptext>Прогнозируемый выход хвостов в %</span></label><input id=vltp type=text value=5 onchange=set_num(); /><label class="tooltip prgline">%</label>     <label class="tooltip prgline">Кубовый остаток<span class=tooltiptext>Прогнозируемый кубовый остаток после завершения перегонки в литрах</span></label><input id=trest type=text value=8 disabled /><label class="tooltip prgline">л</label></div><label class="tooltip prgline" style="margin-top: 10px !important; padding-bottom: 0px !important; margin-bottom: 10px !important;">Информация о параметрах программы отбора <span class=tooltiptext>При работе с СС из сахарной браги<ul><li>Колонна максимальной высоты, плотно набитая насадка</li><li>Отбор - головы в пленочном режиме, тело в режиме максимального разделения (предзахлеб)</li><li>Головы - 10%-15%, хвосты - 5%</li></ul>При работе с СС из фруктов<ul><li>Колонна метр, разреженная насадка</li><li>Начало отбора в пленочном режиме</li><li>После отбора голов увеличить разделение, но не доводить до предзахлеба</li><li>Головы - 8%, хвосты - 5%</li><li>Выход спирта - 94%</li></ul>При работе с СС из зерновых<ul><li>Колонна метр, разреженная насадка</li><li>Начало отбора в пленочном режиме</li><li>После отбора голов увеличить разделение, но не доводить до предзахлеба</li><li>Головы - 6-10%, хвосты - 5-7%</li><li>Выход спирта - 94%</li></ul></span></label></div></div><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em;"><div class=prg id=prg></div></div><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em;"><div><label class="tooltip prgline">Итоговое время отбора<span class=tooltiptext>Время, необходимое для ректификации спирта-сырца с заданными параметрами</span></label><input id=sum type=text disabled /></div></div>

<div>
<textarea cols=40 rows=15 id=WProgram1 name=WProgram1 style="visibility: hidden;position: absolute;width: 20;"></textarea>
<textarea cols=40 rows=15 id=WProgram name=WProgram style="visibility: hidden;position: absolute;width: 20;">%WProgram%</textarea></div><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em;"><div style="margin: 0 auto; width: 200px;"><input id=saveform type=button name=saveform value="Сохранить расчет" onclick=SaveProgramToFile(); class=button /></div><div style="margin: 0 auto; width: 200px;"><label for=fileToLoad class="button custom-file-upload"><i class="fa fa-cloud-upload"></i> Загрузить расчет</label><input type=file id=fileToLoad accept=text/plain onchange=loadFile(this.files[0]) class=button /></div></div><div style="margin: 0 auto; width: 450px;"><input id=setprogram type=button name=setprogram value="Установить программу" onclick=set_program(); class=button /><input id=return type=button name=return value="На главную" onclick='javascript:location.href="/index.htm"' class=button /></div></div></form></body></html>