<html>
<head>
<meta charset='utf-8'>
<meta http-equiv="Cache-Control" content="no-cache">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" href="style.css">
<title>–°–∞–º–æ–≤–∞—Ä</title>

<script>
  var pwr_unit = "%pwr_unit%"; 
var _lnIdx = 0;
var phv = 0;
var ptv = 0;
var pbas = 0;
var programerr;
var glcalcnum = false;

// ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ö–û–õ–û–ù–ù–´ (–¢–û–õ–¨–ö–û –ü–†–û–°–ú–û–¢–†) ==========
var columnParams = null;

function updateColumnParams() {
  const matSelect = document.getElementById("loadprogram");
  const mat = matSelect ? matSelect.value : 2;
  
  fetch("/ajax_col_params?mat=" + mat)
    .then(r => r.json())
    .then(data => {
      console.log("–î–∞–Ω–Ω—ã–µ API:", data);
      if (data) {
        columnParams = data;
        displayColumnParams();
      }
    })
    .catch(err => console.error("–û—à–∏–±–∫–∞ API:", err));
}

function displayColumnParams() {
  if (!columnParams) return;
  const p = columnParams;
  
  const setTxt = (id, val, fixed = 0) => {
    const el = document.getElementById(id);
    if (el) el.textContent = (typeof val === 'number') ? val.toFixed(fixed) : (val || '-');
  };

  setTxt('colFloodPower', p.floodPowerW);
  setTxt('colWorkingPower', p.workingPowerW);
  setTxt('colMaxFlow', p.maxFlowMlH);
  setTxt('colTheoreticalPlates', p.theoreticalPlates, 1);
  
  if (document.getElementById('colHeadsSpeed')) document.getElementById('colHeadsSpeed').textContent = (p.headsFlowMlH / 1000).toFixed(3);
  if (document.getElementById('colBodySpeedMin')) document.getElementById('colBodySpeedMin').textContent = (p.bodyFlowMinMlH / 1000).toFixed(3);
  if (document.getElementById('colBodySpeedMax')) document.getElementById('colBodySpeedMax').textContent = (p.bodyFlowMaxMlH / 1000).toFixed(3);
  
  const heaterMaxPwr = parseFloat(document.getElementById('heaterMaxPower').value) || 3500;
  const pUnit = (pwr_unit === 'V') ? ' –í' : ' –í—Ç';
  
  if (pwr_unit === 'V') {
    const toVolt = (w) => Math.round(220 * Math.sqrt(Math.max(0, w) / heaterMaxPwr));
    setTxt('colFloodPower', toVolt(p.floodPowerW));
    setTxt('colWorkingPower', toVolt(p.workingPowerW));
    const fu = document.getElementById('floodUnit'); if (fu) fu.textContent = ' –í';
    const wu = document.getElementById('workingUnit'); if (wu) wu.textContent = ' –í';
  }

  const strategyNote = document.getElementById('strategyNote');
  if (strategyNote) {
    const mat = parseInt(document.getElementById("loadprogram").value);
    const notes = [
      'üçé <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è "–§—Ä—É–∫—Ç—ã":</b> –ü–ª—ë–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º (–Ω–∏–∑–∫–æ–µ –§–ß) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—Ä–æ–º–∞—Ç–∞.',
      'üåæ <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è "–ó–µ—Ä–Ω–æ":</b> –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –æ—á–∏—Å—Ç–∫–æ–π –∏ –≤–∫—É—Å–æ–º.',
      'üíé <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è "–°–∞—Ö–∞—Ä":</b> –†–µ–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–≤—ã—Å–æ–∫–æ–µ –§–ß) –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —á–∏—Å—Ç–æ—Ç—ã.'
    ];
    strategyNote.innerHTML = notes[mat] || notes[2];
  }
  
  const resBlock = document.getElementById('columnParamsResults');
  if (resBlock) resBlock.style.display = 'block';
}

function applyRecommendedSpeeds() {
  if (!columnParams) { alert('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã'); return; }
  const p = columnParams;
  const programLines = document.getElementById('prg').childNodes;
  let appliedCount = 0;
  
  for (let i = 1; i < programLines.length; i++) {
    const line = programLines[i];
    if (!line || !line.querySelector) continue;
    const type = line.querySelector('select[name^="ptype"]').value;
    const speedInput = line.querySelector('input[name^="speed"]');
    const powerInput = line.querySelector('input[name^="pvolt"]');
    
    let rSpeed = 0; let rPwr = 0;
    if (type == 'H') { rSpeed = p.headsFlowMlH; rPwr = p.headsPowerW; }
    else if (type == 'B' || type == 'C') { rSpeed = p.bodyFlowMaxMlH; rPwr = (type == 'C' ? p.floodPowerW : p.workingPowerW); }
    else if (type == 'T') { rSpeed = p.tailsFlowMlH; rPwr = p.tailsPowerW; }
    
    if (rSpeed > 0) {
      speedInput.value = (rSpeed / 1000).toFixed(3);
      if (powerInput) {
        if (pwr_unit === 'V') {
          const heaterMaxPwr = parseFloat(document.getElementById('heaterMaxPower').value) || 3500;
          powerInput.value = Math.round(220 * Math.sqrt(rPwr / heaterMaxPwr));
        } else {
          powerInput.value = Math.round(rPwr);
        }
      }
      appliedCount++;
    }
  }
  set_num();
  if (appliedCount > 0) alert('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã');
}

function loadFile(e) {
	var file = e;
	var reader = new FileReader();
	reader.onload = function () {
		document.getElementById('WProgram1').value = reader.result;
		glcalcnum = false;
		calc_program();
	};
	reader.readAsText(file, "UTF-8");
}

 function getProgramFromFile(selectObject){
 var value = selectObject.value;
 var fn;
 if (value == 0) fn = 'program_fruit.txt';
 else if (value == 1) fn = 'program_grain.txt';
 else if (value == 2) fn = 'program_shugar.txt';
 
 // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–ª–æ–Ω–Ω—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ —Å—ã—Ä—å—è
 updateColumnParams();
 
 fetch(fn)
  .then(response => response.text())
  .then((data) => {
  document.getElementById('WProgram1').value = data
  glcalcnum = false;
  calc_program();
  })
}

function SaveProgramToFile() {
  var filename, text;
  filename = 'programbackup.txt';
  text = document.getElementById('WProgram1').value;

  var pom = document.createElement('a');
  pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  pom.setAttribute('download', filename);

  pom.style.display = 'none';
  document.body.appendChild(pom);

  pom.click();

  document.body.removeChild(pom);
}

function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
  return 0;
}

function check_program(str){
  var arrayOfStrings = str.split("\n");
  var prevcnt = 0;
  var ret = true;
  var cnt;
  for (i = 0; i < arrayOfStrings.length; i++){
  	var arrayOfDelim = arrayOfStrings[i].split(";");
  	cnt = arrayOfDelim.length;
  	if (cnt == 1 && arrayOfDelim[0] != "" && arrayOfStrings.length == i - 1) ret = false;
  	else if (prevcnt > 0 && cnt > 1) {
  		if (prevcnt != cnt) ret = false;
  	}
  	prevcnt = cnt;
  }
  return ret;
}

function get_time(tm){
  var s = "";
  l = Math.trunc(tm);
  if (l < 10) s = "0";
  s = s + l + ":";
  l = Math.trunc((tm - Math.trunc(tm)) * 60);
  if (l < 10) s = s + "0";
  s = s + l;
  return s;
}

function set_num(){
    prep_calc();
    programerr = false;
    var e = document.getElementById("prg").childNodes;
    var a;
    var v;
    var t;
    var l;
    var sum = 0;
    var sumh = 0;
    var sumt = 0;
    var sumb = 0;
    var prgc = "";
    var prgo = "";
    for (i=1;i<e.length;i++){
      a = e[i].childNodes[0];
      a.innerText = "";
      if (i < 10) a.innerText = "0";
      a.innerText = a.innerText + i;
      //
      if (e[i].childNodes[3].value.indexOf(".") > 0) e[i].childNodes[3].value = e[i].childNodes[3].value.substring(0, e[i].childNodes[3].value.indexOf("."));
      if (e[i].childNodes[3].value.indexOf(",") > 0) e[i].childNodes[3].value = e[i].childNodes[3].value.substring(0, e[i].childNodes[3].value.indexOf(","));
      
      e[i].childNodes[2].value = e[i].childNodes[2].value.replace(",",".");
      e[i].childNodes[5].value = e[i].childNodes[5].value.replace(",",".");

      // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä –µ–º–∫–æ—Å—Ç–∏ –∏–∑ —Å–µ–ª–µ–∫—Ç–∞
      var capacitySelect = document.getElementById("pnum" + (i-1));
      var capacityNum = capacitySelect ? capacitySelect.value : "0";

      v = e[i].childNodes[6];
      t = e[i].childNodes[7];
      var vlc = 1;
      if (e[i].childNodes[4].value == "H") {
        vlc = phv / 100;
        sumh = sumh + Number(e[i].childNodes[3].value);
      }
      else if (e[i].childNodes[4].value == "T") {
        vlc = ptv / 100;
      }
      else if (e[i].childNodes[4].value == "P") {
        vlc = 1;
      }
      else if (e[i].childNodes[4].value == "B" || e[i].childNodes[4].value == "C") {
        vlc = pbas / 100;
        sumb = sumb + Number(e[i].childNodes[3].value);
      }
      ll = (e[i].childNodes[3].value * vlc)
      prgc = prgc + e[i].childNodes[4].value + ";";
      if (e[i].childNodes[4].value == "P") {
	    v.value = e[i].childNodes[2].value;
	    a = v.value / 3600;
	    prgc = prgc + v.value;
      }
      else {
        v.value = ll.toFixed(3);
        a = v.value / e[i].childNodes[2].value;
	    prgc = prgc + v.value * 1000;
      }
      prgc = prgc + ";" + e[i].childNodes[2].value + ";" + capacityNum + ";0;" + e[i].childNodes[5].value + "\n";
      t.value = get_time(a);
      sum = sum + Number(a);
      prgo = prgo + capacityNum + ";" + e[i].childNodes[2].value + ";" + e[i].childNodes[3].value + ";" + e[i].childNodes[4].value + ";" + e[i].childNodes[5].value + "\n"
    }
    document.getElementById("sum").value = get_time(sum);
    var err = ""
    programerr = false;
    if (sumh != 100) err = "–û—à–∏–±–∫–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ - –æ–±—ä–µ–º –≥–æ–ª–æ–≤–Ω—ã—Ö —Ñ—Ä–∞–∫—Ü–∏–π –Ω–µ —Ä–∞–≤–µ–Ω 100 (" + sumh + ")";
    if (sumb != 100) err = "–û—à–∏–±–∫–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ - –æ–±—ä–µ–º —Ñ—Ä–∞–∫—Ü–∏–∏ —Ç–µ–ª–∞ –Ω–µ —Ä–∞–≤–µ–Ω 100 (" + sumb + ")";
    if (err !=""){
      //alert(err);
      programerr = true;
    }
//    if (!programerr) {
      prgc = prgc.slice(0, -1);
      prgo = prgo.slice(0, -1);
      document.getElementById("WProgram1").value = prgo;
      document.getElementById("WProgram").value = prgc;
//    }
    return programerr;
}

function prep_calc(){
    var vless = document.getElementById('vless').value; //A3
    var vlssp = document.getElementById('vlssp').value / 100; //B3
    var vlp = document.getElementById('vlp').value / 100; //B5
    var vlhp = document.getElementById('vlhp').value / 100; //E3
    var vltp = document.getElementById('vltp').value / 100; //H3
    var tas = vless * vlssp; //–°3
    var pas = tas / vlp; //–°5
    var thv = tas * vlhp //F3
    phv = thv / vlp; //F5
    var ttv = tas * vltp; //I3
    ptv = ttv / vlp * 2; //I5
    var tht = ttv + thv; //K3
    var pht = ptv + phv; //K5
    var tbas = tas - tht; //M3
    pbas = tbas / vlp; //M5
    var ttr = vless - tht - tbas; //Q3
    var ptr = (vless - pht - pbas) * 0.9; //Q5
    document.getElementById('trest').value = ptr.toFixed(2);
}

function calc_program(){
    prep_calc();
    let programPwrLabel = pwr_unit == 'P' ? '–ú–æ—â–Ω' : '–ù–∞–ø—Ä';   
    var e = document.getElementById("prg");
    
    while (e.firstChild) {
      e.removeChild(e.firstChild);
    }
      _lnIdx = 0;

    e.insertAdjacentHTML("afterbegin", `<div class="flex_row" style="font-size:18px; margin-bottom: 0.5em; margin-top: 0.5em" id="hdr">
      &nbsp;&nbsp;&nbsp;<label class="tooltip">‚Ññ<span class="tooltiptext">–ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã</span></label>
      &nbsp;&nbsp;<label class="tooltip">–Å–º–∫–æ—Å—Ç—å<span class="tooltiptext">–ù–æ–º–µ—Ä —ë–º–∫–æ—Å—Ç–∏ (–Ω—É–º–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ—Ç 0)</span></label>
      &nbsp;<label class="tooltip">–°–∫–æ—Ä–æ—Å—Ç—å<span class="tooltiptext">–°–∫–æ—Ä–æ—Å—Ç—å –≤ –ª–∏—Ç—Ä–∞—Ö –≤ —á–∞—Å. –î–ª—è —Å—Ç—Ä–æ–∫–∏ —Å —Ç–∏–ø–æ–º "–ü–∞—É–∑–∞" - –≤—Ä–µ–º—è –ø–∞—É–∑—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö</span></label>
      &nbsp;<label class="tooltip">–ü—Ä–æ—Ü–µ–Ω—Ç<span class="tooltiptext">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–±—ä–µ–º–∞ —Ñ—Ä–∞–∫—Ü–∏–∏ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞</span></label>&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label class="tooltip">–¢–∏–ø<span class="tooltiptext">–¢–∏–ø –ø—Ä–æ–≥—Ä–∞–º–º—ã. –î–ª—è —Ä–µ–∂–∏–º–∞ –ü–∞—É–∑–∞ –≤—Ä–µ–º—è –ø–∞—É–∑—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –∑–∞–¥–∞–µ—Ç—Å—è –≤ –ø–æ–ª–µ "–°–∫–æ—Ä–æ—Å—Ç—å"</span></label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label class="tooltip">${programPwrLabel}<span class="tooltiptext">–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏–ª–∏ –º–æ—â–Ω–æ—Å—Ç—å –Ω–∞ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–µ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞)</span></label>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label class="tooltip">–í—ã—Ö–æ–¥<span class="tooltiptext">–û–±—ä–µ–º –æ—Ç–±–∏—Ä–∞–µ–º–æ–π —Ñ—Ä–∞–∫—Ü–∏–∏ –≤ –¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</span></label>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label class="tooltip">–í—Ä–µ–º—è<span class="tooltiptext">–í—Ä–µ–º—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –Ω–∞ –æ—Ç–±–æ—Ä —Ñ—Ä–∞–∫—Ü–∏–∏ –≤ –¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</span></label></div>`);
    var p = document.getElementById("WProgram1");
    var arr = p.value.split("\n");
    for (z=0;z<arr.length;z++){
      addLine(false, arr[z]);
    }
    glcalcnum = true;
    set_num();
}

function set_program(){
glcalcnum = false;
calc_program();
if (programerr) {
  alert( "–í –ø—Ä–æ–≥—Ä–∞–º–º–µ –æ—à–∏–±–∫–∞! –ü—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞" );
  return;
}
var server = '/program';
request = new XMLHttpRequest();
request.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
var myObj = this.responseText;
if (myObj != "OK") {
  document.getElementById('WProgram').value = myObj;
  alert( "Ok" );
}
}
};
request.open('POST', server, false);
let formData = new FormData(document.forms.mainform);
request.send(formData);
if(request.status != 200) {
alert( request.status + ': ' + request.statusText );
}
return 0;
};

function sendbutton(command){
var server = '/command?' + command;
request = new XMLHttpRequest();
request.open('GET', server, false);
request.send();
if(request.status != 200) {
alert( request.status + ': ' + request.statusText );
}
sleep(1000);
return 0;
};

function removeLine(ln){
  var prg = document.getElementById("prg").childNodes.length;
  if (prg < 3) return;
  var prgline = document.getElementById(ln);
  prgline.remove();
  set_num();
}

function addLine(obj, s){
  var calcnum = false;
  if (obj && s == "") {
    var p = document.getElementById(obj).childNodes;
    var ss = "0";
    var sp = 1;
    s = p[1].value + ";" + p[2].value + ";" + ss + ";" + p[4].value + ";0";
    calcnum = true;
  }
  var arr = s.split(";");
  
  var dl = document.createElement("div");
  dl.className = "prgline";
  dl.id = "prgln" + _lnIdx;
  
  var num = document.createElement("label");
  num.className = "prglabel";
  dl.appendChild(num);
  
  num.insertAdjacentHTML("afterend", '<select id="pnum' + _lnIdx + '" name="pnum' + _lnIdx + '"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select>');
  
  var speed = document.createElement("input");
  speed.type = "text";
  speed.name = "speed" + _lnIdx;
  speed.value = arr[1];
  speed.setAttribute("onchange", "set_num();");
  dl.appendChild(speed);
  
  var percent = document.createElement("input");
  percent.type = "text";
  percent.name = "percent" + _lnIdx;
  percent.value = arr[2];
  percent.setAttribute("onchange", "set_num();");
  dl.appendChild(percent);
  
  percent.insertAdjacentHTML("afterend", '<select id="ptype' + _lnIdx + '" name="ptype' + _lnIdx + '" onchange="set_bgcolor(' + _lnIdx + ')"><option value="H">–ì–æ–ª–æ–≤—ã</option><option value="B">–¢–µ–ª–æ</option><option value="C">–ü—Ä–µ–¥–∑–∞—Ö–ª–µ–±</option><option value="T">–•–≤–æ—Å—Ç—ã</option><option value="P">–ü–∞—É–∑–∞</option></select>');
  
  var pvolt = document.createElement("input");
  pvolt.type = "text";
  pvolt.name = "pvolt" + _lnIdx;
  pvolt.value = arr[4];
  pvolt.setAttribute("onchange", "set_num();");
  dl.appendChild(pvolt);
  
  var pvl = document.createElement("input");
  pvl.type = "text";
  pvl.name = "pvl" + _lnIdx;
  pvl.setAttribute("disabled", "");
  dl.appendChild(pvl);

  var tm = document.createElement("input");
  tm.type = "text";
  tm.name = "tm" + _lnIdx;
  tm.setAttribute("disabled", "");
  dl.appendChild(tm);

  var plus = document.createElement("img");
  plus.src = 'plus.png';
  plus.setAttribute("width", "20");
  plus.setAttribute("onclick", "addLine('prgln" + _lnIdx + "','')");
  dl.appendChild(plus);
  
  var minus = document.createElement("img");
  minus.src = 'minus.png';
  minus.setAttribute("width", "20");
  minus.setAttribute("onclick", "removeLine('prgln" + _lnIdx + "')");
  dl.appendChild(minus);

  if (!obj){
    var prg = document.getElementById("prg");
    prg.appendChild(dl);
  } else {
    prg = document.getElementById(obj);
    prg.after(dl);
  }

  var p = "ptype" + _lnIdx;
  var ptype = document.getElementById(p);
  ptype.value = arr[3];

  var pnum = document.getElementById("pnum" + _lnIdx);
  pnum.selectedIndex = arr[0];
  pnum.onchange = set_num;
  
  set_bgcolor(_lnIdx);
  
  _lnIdx++;
  
  if (calcnum) set_num();
}

function set_bgcolor(obj){
  var l = document.getElementById("prgln" + obj);
  var t = document.getElementById("ptype" + obj).value;
  if (t == "H"){color = "background-color: #80FFFA;";}
  else if (t == "B"){color = "background-color: #32CD3229;";}
  else if (t == "C"){color = "background-color: #FFFF0039;";}
  else if (t == "P"){color = "background-color: #C4C4C4;";}
  else if (t == "T"){color = "background-color: #8B451334;";}
  l.setAttribute("style",color);
  var e = l.childNodes;
  for(q=0;q<e.length;q++){
    e[q].setAttribute("style",color);
  }
  if (glcalcnum) set_num();
}

window.onload = function() {
  updateColumnParams();
  const loadProgramSelect = document.getElementById("loadprogram");
  if (loadProgramSelect) {
    getProgramFromFile(loadProgramSelect);
  }
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ—â–Ω–æ—Å—Ç–∏ –¢–≠–ù–∞ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  const heaterPowerInput = document.getElementById('heaterMaxPower');
  if (heaterPowerInput) {
    heaterPowerInput.addEventListener('input', function() {
      // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (–¥–ª—è —Ä–µ–∂–∏–º–∞ –≤–æ–ª—å—Ç)
      if (columnParams) {
        displayColumnParams();
      }
    });
  }
};

</script>
</head>
<body>
<form action='none' onsubmit='return false' name="mainform" id="mainform">
<h1>
<div class="message-box" style="display: none;" id="message"></div>
Samovar v. <span id='version'>%v%</span>
</h1>
<div class="text">–†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ—Ç–±–æ—Ä–∞
<select id="loadprogram" name="loadprogram" onchange="getProgramFromFile(this)">
  <option value="0">–§—Ä—É–∫—Ç—ã</option>
  <option value="1">–ó–µ—Ä–Ω–æ</option>
  <option value="2">–°–∞—Ö–∞—Ä</option>
</select>
</div>

<!-- –ë–õ–û–ö –ü–ê–†–ê–ú–ï–¢–†–û–í –ö–û–õ–û–ù–ù–´ (–¢–û–õ–¨–ö–û –ü–†–û–°–ú–û–¢–†) -->
<div class="tabcontent" style="display: block; border-top: 1px solid #ccc; padding: 10px;">
  <div style="border: 2px solid #3498db; background: #fafafa; padding: 15px; border-radius: 5px;">
    <div style="color: #3498db; font-weight: bold; margin-bottom: 10px;">‚öôÔ∏è –ü–ê–†–ê–ú–ï–¢–†–´ –û–ë–û–†–£–î–û–í–ê–ù–ò–Ø</div>
    <div style="font-size: 0.9em; margin-bottom: 10px; color: #666;">
      –î–∏–∞–º–µ—Ç—Ä: <b>%ColDiam% –¥—é–π–º–∞</b> | –í—ã—Å–æ—Ç–∞: <b>%ColHeight% –º</b> | –ù–∞—Å–∞–¥–∫–∞: <b>%PackDens%&#37;</b>
    </div>

    <div id="heaterPowerBlock" style="display: %pwr_unit_v_only%; margin-bottom: 10px;">
      –ú–æ—â–Ω–æ—Å—Ç—å –¢–≠–ù–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞: <input type="text" id="heaterMaxPower" value="%HeaterMaxPower%" onchange="displayColumnParams()" style="width: 70px;"> –í—Ç
    </div>

    <div id="columnParamsResults" style="display: none; background: #fff; border: 1px solid #3498db; padding: 10px; border-radius: 4px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px;">
        <span>–ó–∞—Ö–ª—ë–±: <b id="colFloodPower">-</b><span id="floodUnit"> –í—Ç</span></span>
        <span>–†–∞–±–æ—á–∞—è: <b id="colWorkingPower">-</b><span id="workingUnit"> –í—Ç</span></span>
        <span>–ú–∞–∫—Å.–æ—Ç–±–æ—Ä: <b id="colMaxFlow">-</b> –º–ª/—á</span>
      </div>
      <div style="margin-bottom: 10px;">
        –ì–æ–ª–æ–≤—ã: <b id="colHeadsSpeed">-</b> –ª/—á | –¢–µ–ª–æ: <b id="colBodySpeedMin">-</b>...<b id="colBodySpeedMax">-</b> –ª/—á | –¢–∞—Ä–µ–ª–æ–∫: <b id="colTheoreticalPlates">-</b>
      </div>
      <div id="strategyNote" style="font-size: 0.85em; margin-bottom: 10px; padding: 5px; background: #eee;"></div>
      <input type="button" class="button" value="–ü–†–ò–ú–ï–ù–ò–¢–¨ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò" onclick="applyRecommendedSpeeds()" style="width: 100%; background: #3498db; color: white;">
    </div>
  </div>
</div>

<div class="tabcontent" style="display: block;border-top: solid;border-top-width: 1px;border-top-color: rgb(204, 204, 204);">

<div class="container_row" style="border: 1px dashed #bbb; margin-bottom: 1em;">
<div id="Prog">
<div style="margin-bottom: 10px !important;">
<label class="tooltip prgline">–û–±—ä–µ–º —Å–ø–∏—Ä—Ç–∞-—Å—ã—Ä—Ü–∞</label><input id='vless' name='vless' type='text' value='12.25' onchange="set_num();"><label class="tooltip prgline">–ª</label>&nbsp;&nbsp;&nbsp;&nbsp;
<label class="tooltip prgline">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ê–° –≤ —Å-—Å<span class="tooltiptext">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ —Å–ø–∏—Ä—Ç–∞ –≤ —Å–ø–∏—Ä—Ç–µ-—Å—ã—Ä—Ü–µ –≤ &#37;</span></label><input id='vlssp' type='text' value='34' onchange="set_num();"><label class="tooltip prgline">&#37;</label>&nbsp;&nbsp;&nbsp;&nbsp;
<label class="tooltip prgline">–í—ã—Ö–æ–¥ —Å–ø–∏—Ä—Ç–∞<span class="tooltiptext">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–π –≤—ã—Ö–æ–¥ —Å–ø–∏—Ä—Ç–∞ –≤ &#37;</span></label><input id='vlp' type='text' value='94' onchange="set_num();"><label class="tooltip prgline">&#37;</label>
</div>
<div style="margin-top: 10px !important; padding-bottom: 0px !important; margin-bottom: 10px !important;">
<label class="tooltip prgline">–û–±—ä–µ–º –≥–æ–ª–æ–≤<span class="tooltiptext">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–π –≤—ã—Ö–æ–¥ –≥–æ–ª–æ–≤ –≤ &#37;</span></label><input id='vlhp' type='text' value='8' onchange="set_num();"><label class="tooltip prgline">&#37;</label>&nbsp;&nbsp;&nbsp;&nbsp;
<label class="tooltip prgline">–û–±—ä–µ–º —Ö–≤–æ—Å—Ç–æ–≤<span class="tooltiptext">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–π –≤—ã—Ö–æ–¥ —Ö–≤–æ—Å—Ç–æ–≤ –≤ &#37;</span></label><input id='vltp' type='text' value='5' onchange="set_num();"><label class="tooltip prgline">&#37;</label>&nbsp;&nbsp;&nbsp;&nbsp;
<label class="tooltip prgline">–ö—É–±–æ–≤—ã–π –æ—Å—Ç–∞—Ç–æ–∫<span class="tooltiptext">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–π –∫—É–±–æ–≤—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ–≥–æ–Ω–∫–∏ –≤ –ª–∏—Ç—Ä–∞—Ö</span></label><input id='trest' type='text' value='8' disabled><label class="tooltip prgline">–ª</label>
</div>
<label class="tooltip prgline" style="margin-top: 10px !important; padding-bottom: 0px !important; margin-bottom: 10px !important;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ—Ç–±–æ—Ä–∞
<span class="tooltiptext">
–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –°–° –∏–∑ —Å–∞—Ö–∞—Ä–Ω–æ–π –±—Ä–∞–≥–∏
<ul>
<li>–ö–æ–ª–æ–Ω–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã, –ø–ª–æ—Ç–Ω–æ –Ω–∞–±–∏—Ç–∞—è –Ω–∞—Å–∞–¥–∫–∞</li>
<li>–û—Ç–±–æ—Ä - –≥–æ–ª–æ–≤—ã –≤ –ø–ª–µ–Ω–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ, —Ç–µ–ª–æ –≤ —Ä–µ–∂–∏–º–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–ø—Ä–µ–¥–∑–∞—Ö–ª–µ–±)</li>
<li>–ì–æ–ª–æ–≤—ã - 10&#37;-15&#37;, —Ö–≤–æ—Å—Ç—ã - 5&#37;</li>
</ul>
–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –°–° –∏–∑ —Ñ—Ä—É–∫—Ç–æ–≤
<ul>
<li>–ö–æ–ª–æ–Ω–Ω–∞ –º–µ—Ç—Ä, —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω–∞—è –Ω–∞—Å–∞–¥–∫–∞</li>
<li>–ù–∞—á–∞–ª–æ –æ—Ç–±–æ—Ä–∞ –≤ –ø–ª–µ–Ω–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ</li>
<li>–ü–æ—Å–ª–µ –æ—Ç–±–æ—Ä–∞ –≥–æ–ª–æ–≤ —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ, –Ω–æ –Ω–µ –¥–æ–≤–æ–¥–∏—Ç—å –¥–æ –ø—Ä–µ–¥–∑–∞—Ö–ª–µ–±–∞</li>
<li>–ì–æ–ª–æ–≤—ã - 8&#37;, —Ö–≤–æ—Å—Ç—ã - 5&#37;</li>
<li>–í—ã—Ö–æ–¥ —Å–ø–∏—Ä—Ç–∞ - 94&#37;</li>
</ul>
–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –°–° –∏–∑ –∑–µ—Ä–Ω–æ–≤—ã—Ö
<ul>
<li>–ö–æ–ª–æ–Ω–Ω–∞ –º–µ—Ç—Ä, —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω–∞—è –Ω–∞—Å–∞–¥–∫–∞</li>
<li>–ù–∞—á–∞–ª–æ –æ—Ç–±–æ—Ä–∞ –≤ –ø–ª–µ–Ω–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ</li>
<li>–ü–æ—Å–ª–µ –æ—Ç–±–æ—Ä–∞ –≥–æ–ª–æ–≤ —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ, –Ω–æ –Ω–µ –¥–æ–≤–æ–¥–∏—Ç—å –¥–æ –ø—Ä–µ–¥–∑–∞—Ö–ª–µ–±–∞</li>
<li>–ì–æ–ª–æ–≤—ã - 6-10&#37;, —Ö–≤–æ—Å—Ç—ã - 5-7&#37;</li>
<li>–í—ã—Ö–æ–¥ —Å–ø–∏—Ä—Ç–∞ - 94&#37;</li>
</ul>
</span></label>
</div>
</div>

<div class="container_row" style="border: 1px dashed #bbb; margin-bottom: 1em;">
<div class="prg" id="prg"></div>
</div>
<div class="container_row" style="border: 1px dashed #bbb; margin-bottom: 1em;">
<div>
<label class="tooltip prgline">–ò—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è –æ—Ç–±–æ—Ä–∞<span class="tooltiptext">–í—Ä–µ–º—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è —Ä–µ–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–ø–∏—Ä—Ç–∞-—Å—ã—Ä—Ü–∞ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</span></label><input id='sum' type='text' value='' disabled>
</div>
</div>

<div>
<textarea cols="40" rows="15" id='WProgram1' name='WProgram1' style="visibility: hidden;position: absolute;width: 20;"></textarea>
<textarea cols="40" rows="15" id='WProgram' name='WProgram' style="visibility: hidden;position: absolute;width: 20;">%WProgram%</textarea>
</div>

<div class="container_row" style="border: 1px dashed #bbb; margin-bottom: 1em;">
<div style="margin: 0 auto; width: 200px;">
<input id='saveform' type='button' name='saveform' value='–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—á–µ—Ç' onclick='SaveProgramToFile();' class="button">
</div>
<div style="margin: 0 auto; width: 200px;">
<label for="fileToLoad" class="button custom-file-upload">
    <i class="fa fa-cloud-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å—á–µ—Ç 
</label>
<input type="file" id="fileToLoad" accept="text/plain" onchange="loadFile(this.files[0])" class="button"/>
</div>
</div>
<div style="margin: 0 auto; width: 450px;">
<input id='setprogram' type='button' name='setprogram' value='–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É' onclick='set_program();' class="button">
<input id='return' type='button' name='return' value='–ù–∞ –≥–ª–∞–≤–Ω—É—é' onclick='javascript:location.href="index.htm"' class="button">
</div>
</div>
</form>
</body>
</html>