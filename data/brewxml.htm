<html><head><meta charset=utf-8 /><meta http-equiv=Cache-Control content=no-cache /><link rel="shortcut icon" href=/favicon.ico type=image/x-icon /><link rel=stylesheet href=/style.css /><title>Самовар</title><script>function decimalAdjust(n,t,i){return typeof i=="undefined"||+i==0?Math[n](t):(t=+t,i=+i,isNaN(t)||!(typeof i=="number"&&i%1==0))?NaN:(t=t.toString().split("e"),t=Math[n](+(t[0]+"e"+(t[1]?+t[1]-i:-i))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+i:i)))}function compare(n,t){return(a1=decimalAdjust("round",get_object_value(n.TIME)),b1=decimalAdjust("round",get_object_value(t.TIME)),a1<b1)?1:a1>b1?-1:0}function loadBeerXML(n){var r=n,i="",t=new FileReader;t.onload=function(){var u,r;t.result.indexOf("namerecipe")>0?(i="bm",u=n,r=new FileReader,r.onload=function(){get_brewmate_info(r.result)},r.readAsText(u,"windows-1251")):(i="bx",u=n,r=new FileReader,r.onload=function(){get_brew_info(r.result)},r.readAsText(u,"UTF-8"))};t.readAsText(r,"UTF-8")}function parseXml(n,t){function r(n,i){if(n.nodeName=="#text"){let t=n.nodeValue;t.trim()&&(i["#text"]=t);return}let u={},f=i[n.nodeName];if(f?Array.isArray(f)?i[n.nodeName].push(u):i[n.nodeName]=[f,u]:i[n.nodeName]=t&&t.indexOf(n.nodeName)!=-1?[u]:u,n.attributes)for(let t of n.attributes)u[t.nodeName]=t.nodeValue;for(let t of n.childNodes)r(t,u)}let i=null;if(window.DOMParser)i=(new DOMParser).parseFromString(n,"text/xml");else if(window.ActiveXObject){if(i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,!i.loadXML(n))throw i.parseError.reason+" "+i.parseError.srcText;}else throw new Error("cannot parse xml string!");let u={};for(let n of i.childNodes)r(n,u);return u}function isArray(n){return n==null?!1:Symbol.iterator in Object(n)}function isNumeric(n){return typeof n!="string"?!1:!isNaN(n)&&!isNaN(parseFloat(n))}function get_object_value(n,t="",i=-2){return typeof n!="undefined"?isNumeric(n["#text"])?decimalAdjust("round",parseFloat(n["#text"]),i)+t:typeof n["#text"]!="undefined"?n["#text"]+t:"Нет в рецепте":"Нет в рецепте"}function check_value(n,t){return n!="Нет в рецепте"?n:t=="bt"?60:t=="pt"?20:void 0}function get_brew_info(n){let t=parseXml(n);get_recipe(t)}function get_brewmate_info(n){var i,r,u,f;let t=parseXml(n);t.RECIPES=Object.create(null);t.RECIPES.RECIPE=Object.create(null);t.RECIPES.RECIPE.STYLE=Object.create(null);t.RECIPES.RECIPE.STYLE.NAME=t.recipe.style;t.RECIPES.RECIPE.NAME=t.recipe.namerecipe;t.RECIPES.RECIPE.BATCH_SIZE=t.recipe.part;t.RECIPES.RECIPE.BOIL_TIME=t.recipe.timeboil;t.RECIPES.RECIPE.PRIMARY_TEMP=t.recipe.timebro;t.RECIPES.RECIPE.YEASTS=Object.create(null);t.RECIPES.RECIPE.YEASTS.YEAST=Object.create(null);t.RECIPES.RECIPE.YEASTS.YEAST.NAME=t.recipe.yeast;t.RECIPES.RECIPE.FERMENTABLES=Object.create(null);t.RECIPES.RECIPE.FERMENTABLES.FERMENTABLE=t.recipe.grains.grain;i=[];Array.isArray(t.RECIPES.RECIPE.FERMENTABLES.FERMENTABLE)?i=t.RECIPES.RECIPE.FERMENTABLES.FERMENTABLE:i.push(t.RECIPES.RECIPE.FERMENTABLES.FERMENTABLE);for(let n of i)n.NAME=n.grainname,n.AMOUNT=n.grainkg;t.RECIPES.RECIPE.HOPS=Object.create(null);t.RECIPES.RECIPE.HOPS.HOP=t.recipe.hops.hop;r=[];Array.isArray(t.RECIPES.RECIPE.HOPS.HOP)?r=t.RECIPES.RECIPE.HOPS.HOP:r.push(t.RECIPES.RECIPE.HOPS.HOP);for(let n of r)n.NAME=n.hopname,n.AMOUNT=n.hopproc,n.TIME=n.hoptime;t.RECIPES.RECIPE.MASH=Object.create(null);t.RECIPES.RECIPE.MASH.MASH_STEPS=Object.create(null);t.RECIPES.RECIPE.MASH.MASH_STEPS.MASH_STEP=t.recipe.zatirs.zatir;u=[];Array.isArray(t.RECIPES.RECIPE.MASH.MASH_STEPS.MASH_STEP)?u=t.RECIPES.RECIPE.MASH.MASH_STEPS.MASH_STEP:u.push(t.RECIPES.RECIPE.MASH.MASH_STEPS.MASH_STEP);for(let n of u)n.STEP_TEMP=n.zatirgr,n.STEP_TIME=n.zatirtime;t.RECIPES.RECIPE.MISCS=Object.create(null);t.RECIPES.RECIPE.MISCS.MISC=t.recipe.misc;f=[];Array.isArray(t.RECIPES.RECIPE.MISCS.MISC)?f=t.RECIPES.RECIPE.MISCS.MISC:t.RECIPES.RECIPE.MISCS.MISC===undefined||f.push(t.RECIPES.RECIPE.MISCS.MISC);for(let n of f)n.TYPE=n.misctype,n.NAME=n.miscname,n.AMOUNT=n.miscgr;get_recipe(t)}function get_recipe(n){var l,s,a,v,f,e,y,p,w,b,i,r,u,h,c,o;is_program=!1;program="M;45.00;0\n";document.getElementById("STYLE").textContent=get_object_value(n.RECIPES.RECIPE.STYLE.NAME);document.getElementById("NAME").textContent=get_object_value(n.RECIPES.RECIPE.NAME);document.getElementById("TYPE").textContent=get_object_value(n.RECIPES.RECIPE.TYPE);document.getElementById("BATCH_SIZE").textContent=get_object_value(n.RECIPES.RECIPE.BATCH_SIZE," л.");document.getElementById("BOIL_SIZE").textContent=get_object_value(n.RECIPES.RECIPE.BOIL_SIZE," л.");document.getElementById("BOIL_TIME").textContent=get_object_value(n.RECIPES.RECIPE.BOIL_TIME," мин.");document.getElementById("NOTES").innerHTML=get_object_value(n.RECIPES.RECIPE.NOTES);document.getElementById("PRIMARY_TEMP").innerHTML=get_object_value(n.RECIPES.RECIPE.PRIMARY_TEMP," &deg;С");e=document.createElement("div");i=document.createElement("div");i.className="ingredients";u=document.createElement("label");u.textContent="Тип";u.className="ingType";i.appendChild(u);r=document.createElement("label");r.textContent="Название";r.className="ingName";r.style="text-align: center;";i.appendChild(r);f=document.createElement("label");f.textContent="Количество";f.className="ingAmount";i.appendChild(f);e.appendChild(i);o=document.getElementById("ingredients");o.innerHTML="";o.appendChild(e);l=[];Array.isArray(n.RECIPES.RECIPE.FERMENTABLES.FERMENTABLE)?l=n.RECIPES.RECIPE.FERMENTABLES.FERMENTABLE:l.push(n.RECIPES.RECIPE.FERMENTABLES.FERMENTABLE);for(let n of l)i=document.createElement("div"),i.className="ingredients",u=document.createElement("label"),u.textContent=get_object_value(n.TYPE)=="Adjunct"?"Добавка":"Солод",u.className="ingType",i.appendChild(u),r=document.createElement("label"),r.textContent=get_object_value(n.NAME),r.className="ingName",i.appendChild(r),f=document.createElement("label"),f.textContent=get_object_value(n.AMOUNT,"",-2),f.className="ingAmount",i.appendChild(f),e.appendChild(i);s=[];Array.isArray(n.RECIPES.RECIPE.HOPS.HOP)?s=n.RECIPES.RECIPE.HOPS.HOP:s.push(n.RECIPES.RECIPE.HOPS.HOP);for(let n of s)i=document.createElement("div"),i.className="ingredients",u=document.createElement("label"),u.textContent="Хмель",u.className="ingType",i.appendChild(u),r=document.createElement("label"),r.textContent=get_object_value(n.NAME),r.className="ingName",i.appendChild(r),f=document.createElement("label"),f.textContent=get_object_value(n.AMOUNT,"",-4),f.className="ingAmount",i.appendChild(f),e.appendChild(i);a=[];Array.isArray(n.RECIPES.RECIPE.YEASTS.YEAST)?a=n.RECIPES.RECIPE.YEASTS.YEAST:a.push(n.RECIPES.RECIPE.YEASTS.YEAST);for(let n of a)i=document.createElement("div"),i.className="ingredients",u=document.createElement("label"),u.textContent="Дрожжи",u.className="ingType",i.appendChild(u),r=document.createElement("label"),r.textContent=get_object_value(n.NAME),r.className="ingName",i.appendChild(r),f=document.createElement("label"),f.textContent=get_object_value(n.AMOUNT,"",-2),f.className="ingAmount",i.appendChild(f),e.appendChild(i);v=[];Array.isArray(n.RECIPES.RECIPE.MISCS.MISC)?v=n.RECIPES.RECIPE.MISCS.MISC:n.RECIPES.RECIPE.MISCS.MISC===undefined||v.push(n.RECIPES.RECIPE.MISCS.MISC);for(let n of v)(get_object_value(n.TYPE)=="Flavor"||get_object_value(n.TYPE)=="Fining")&&(i=document.createElement("div"),i.className="ingredients",u=document.createElement("label"),get_object_value(n.TYPE)=="Flavor"?u.textContent="Специи":get_object_value(n.TYPE)=="Fining"&&(u.textContent="Очистка"),u.className="ingType",i.appendChild(u),r=document.createElement("label"),r.textContent=get_object_value(n.NAME),r.className="ingName",i.appendChild(r),f=document.createElement("label"),f.textContent=get_object_value(n.AMOUNT,"",-4),f.className="ingAmount",i.appendChild(f),e.appendChild(i));e=document.createElement("div");i=document.createElement("div");i.className="ingredients";r=document.createElement("label");r.textContent="Название";r.className="mashName";i.appendChild(r);y=document.createElement("label");y.textContent="Тип";y.className="mashType";i.appendChild(y);p=document.createElement("label");p.textContent="Температура";p.className="mashTemp";i.appendChild(p);w=document.createElement("label");w.textContent="Время";w.className="mashTime";i.appendChild(w);e.appendChild(i);b=[];Array.isArray(n.RECIPES.RECIPE.MASH.MASH_STEPS.MASH_STEP)?b=n.RECIPES.RECIPE.MASH.MASH_STEPS.MASH_STEP:b.push(n.RECIPES.RECIPE.MASH.MASH_STEPS.MASH_STEP);for(let n of b)i=document.createElement("div"),i.className="ingredients",r=document.createElement("label"),r.textContent=get_object_value(n.NAME),r.className="mashName",i.appendChild(r),u=document.createElement("label"),u.textContent=get_object_value(n.TYPE),u.className="mashType",i.appendChild(u),h=document.createElement("label"),h.textContent=get_object_value(n.STEP_TEMP),h.className="mashTemp",i.appendChild(h),c=document.createElement("label"),c.textContent=get_object_value(n.STEP_TIME),c.className="mashTemp",i.appendChild(c),e.appendChild(i),program=program+"P;"+h.textContent+";"+c.textContent+"\n";o=document.getElementById("mash");o.innerHTML="";o.appendChild(e);pt=check_value(get_object_value(n.RECIPES.RECIPE.PRIMARY_TEMP),"pt");bth=decimalAdjust("round",check_value(get_object_value(n.RECIPES.RECIPE.BOIL_TIME),"bt"));t=0;s.sort(compare);for(let n of s)t=decimalAdjust("round",get_object_value(n.TIME)),bth-t<=0?program=program+"B;0.00;1\n":(program=program+"B;0.00;"+(bth-t)+"\n",bth=t);bth>0&&(program=program+"B;0.00;"+bth+"\n");program=program+"C;"+pt+";0\nF;"+pt+";0";is_program=!0}function set_program(){if(!is_program){alert("Error");return}alert(program);document.getElementById("WProgram").value=program;request=new XMLHttpRequest;request.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var n=this.responseText;n!="OK"&&(document.getElementById("WProgram").value=n,alert("Ok"))}};request.open("POST","/program",!1);let n=new FormData(document.forms.mainform);return request.send(n),request.status!=200&&alert(request.status+": "+request.statusText),0}var is_program=!1,program=""</script></head><body><form action=none onsubmit="return false" name=mainform id=mainform><h1><div class=message-box style="display: none;" id=message></div>Samovar v. <span id=version>%v%</span></h1><div class=text>Программа затирания</div><div style="margin: 20 auto; width: 200px;"><label for=fileToLoad class="button custom-file-upload"><i class="fa fa-cloud-upload"></i>Загрузить рецепт</label><input type=file id=fileToLoad accept=application/xml onchange=loadBeerXML(this.files[0]) class=button /></div><div class=tabcontent style="display: block;border-top: solid;border-top-width: 1px;border-top-color: rgb(204, 204, 204);"><div id=brew><label style="font-size: 20px; font-weight: 600;">Описание рецепта:</label><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em;"><div class=specs><div> <label>Стиль:</label><label class=specs id=STYLE></label></div><div><label>Сорт:</label><label class=specs id=NAME></label></div><div><label>Тип:</label><label class=specs id=TYPE></label></div><div><label>Выход:</label><label class=specs id=BATCH_SIZE></label></div><div><label>Объем кипения:</label><label class=specs id=BOIL_SIZE></label></div><div><label>Температура брожения:</label><label class=specs id=PRIMARY_TEMP></label></div><div><label>Время кипения:</label><label class=specs id=BOIL_TIME></label></div><div><label>Заметки:</label><label class=specs id=NOTES></label></div></div></div><div classname=ingredients><label style="font-size: 20px; font-weight: 600;">Ингредиенты:</label><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em;"><div id=ingredients></div></div></div><div classname=ingredients><label style="font-size: 20px; font-weight: 600;">Температурные паузы:</label><div class=container_row style="border: 1px dashed #bbb; margin-bottom: 1em;"><div id=mash></div></div></div><div style="margin: 0 auto; width: 450px;"><input id=setprogram type=button name=setprogram value="Установить программу" onclick=set_program(); class=button /><input id=return type=button name=return value="На главную" onclick='javascript:location.href="/index.htm"' class=button /></div></div></div>
<textarea cols=40 rows=7 id=WProgram name=WProgram style="visibility: hidden;"></textarea></form></body></html>