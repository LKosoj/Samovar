# platformio.ini

Файл `platformio.ini` — это конфигурационный файл проекта PlatformIO, определяющий параметры сборки, загрузки, платформы и окружения для встраиваемых приложений. Он позволяет настраивать платформу, плату, фреймворк, фильтры исходных файлов, параметры компиляции и другие опции. В данном случае конфигурация предназначена для сборки проекта под ESP32 с использованием фреймворка Arduino и оптимизацией размера прошивки.

Секции и ключи

platformio — корневая секция с глобальными настройками проекта<br>
src_dir — указывает директорию с исходным кодом, в данном случае корневая папка проекта<br>
env:Samovar — секция окружения с именем Samovar, определяет параметры сборки для конкретной платы<br>
platform — указывает платформу, здесь используется ESP32 через ссылку на репозиторий PlatformIO<br>
board — модель целевой платы, в данном случае esp32doit-devkit-v1<br>
framework — используемый фреймворк, здесь Arduino<br>
build_type — тип сборки, установлен в release для оптимизации<br>
lib_ignore — игнорирование всех библиотек по умолчанию<br>
lib_extra_dirs — дополнительные директории для поиска библиотек<br>
build_src_filter — фильтр исходных файлов, включает всё, кроме указанных исключений<br>
board_build.partitions — путь к файлу с описанием разделов памяти (partitions)<br>
board_build.f_cpu — частота процессора в герцах<br>
board_build.f_flash — частота работы flash-памяти<br>
board_build.flash_mode — режим работы flash-памяти (dio, qio и др.)<br>
monitor_speed — скорость последовательного порта для мониторинга<br>
monitor_filters — фильтры вывода монитора, например, декодирование исключений ESP32<br>
platform_packages — дополнительные пакеты, необходимые для сборки, включая кастомный инструмент для разделов<br>
board_build.filesystem — тип файловой системы, используемой на устройстве (здесь littlefs)<br>
build_flags — флаги компилятора и компоновщика, влияющие на оптимизацию и поведение прошивки

Важные параметры

-Os — оптимизация компиляции по размеру, уменьшает объём прошивки<br>
-Wl,--gc-sections — включение сборки мусора на уровне секций, удаляет неиспользуемый код и данные<br>
-DCONFIG_ESP_BROWNOUT_DET=1 — включение детектора просадки напряжения питания, предотвращает нестабильную работу<br>
-DCONFIG_ESP_BROWNOUT_DET_LVL_SEL_3 — установка порога срабатывания brownout на 2.62 В<br>
-Wl,-Map,firmware.map — генерация map-файла для анализа использования памяти и размера секций<br>
board_build.filesystem = littlefs — выбор файловой системы LittleFS вместо по умолчанию (SPIFFS)<br>
build_src_filter — управление включением/исключением файлов из сборки, позволяет исключить ненужные директории
