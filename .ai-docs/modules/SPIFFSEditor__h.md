# SPIFFSEditor

SPIFFSEditor — это веб-обработчик для асинхронного сервера ESPAsyncWebServer, обеспечивающий доступ к файловой системе SPIFFS (или другой файловой системе на ESP32/ESP8266) через веб-интерфейс. Он позволяет просматривать список файлов, редактировать, загружать и удалять файлы в SPIFFS. Поддерживается фильтрация файлов через список исключений с подстановочными знаками (`*`, `?`), а также опциональная интеграция с Lua-скриптами.

Ключевые структуры данных  
ExcludeList — односвязный список строк (шаблонов исключения), используемый для фильтрации файлов, которые не должны отображаться или быть доступными через веб-интерфейс.

---
String get_edit_script()  
Возвращает содержимое JavaScript-скрипта, используемого на стороне клиента для веб-редактора.  
Возвращает  
Строка с JavaScript-кодом, реализующим функциональность редактора.

---
#ifdef USE_LUA  
void load_lua_script()  
Загружает и выполняет Lua-скрипт из файла в SPIFFS.  
Исключения

---
String IRAM_ATTR getValue(const String& data, char separator, int index)  
Извлекает подстроку из строки `data`, разделённой символом `separator`, по заданному индексу `index`.  
Аргументы  
data — исходная строка, содержащая разделённые значения.  
separator — символ-разделитель (например, запятая или точка с запятой).  
index — индекс требуемой части строки (начиная с 0).  
Возвращает  
Подстрока, находящаяся по указанному индексу после разделения.

---
class SPIFFSEditor  
Асинхронный веб-обработчик для управления файлами в SPIFFS через HTTP-запросы.  
Поля  
_fs — ссылка на объект файловой системы (SPIFFS или другая).  
Методы  
SPIFFSEditor(const fs::FS& fs) — конструктор, инициализирующий обработчик с указанной файловой системой.  
canHandle(AsyncWebServerRequest *request) — определяет, может ли обработчик взять на себя обработку HTTP-запроса.  
handleRequest(AsyncWebServerRequest *request) — обрабатывает GET, POST, PUT и DELETE запросы для работы с файлами.  
handleUpload(AsyncWebServerRequest *request, const String& filename, size_t index, uint8_t *data, size_t len, bool final) — обрабатывает загрузку файлов в SPIFFS.  
isRequestHandlerTrivial() — возвращает false, указывая, что обработчик не является тривиальным (требует состояния).

---
static bool matchWild(const char *pattern, const char *testee)  
Проверяет, соответствует ли строка `testee` шаблону `pattern` с поддержкой подстановочных знаков `*` и `?`.  
Аргументы  
pattern — шаблон с возможными символами `*` (любое количество символов) и `?` (один символ).  
testee — строка, которую проверяют на соответствие шаблону.  
Возвращает  
true, если строка соответствует шаблону; иначе false.

---
static bool addExclude(const char *item)  
Добавляет элемент в глобальный список исключений (excludes).  
Аргументы  
item — строка с шаблоном пути или имени файла для исключения.  
Возвращает  
true при успешном добавлении; иначе false.

---
static void loadExcludeList(fs::FS &_fs, const char *filename)  
Загружает список исключений из файла в файловой системе (по умолчанию /.exclude.files).  
Аргументы  
_fs — ссылка на файловую систему.  
filename — путь к файлу со списком исключений.

---
static bool isExcluded(fs::FS &_fs, const char *filename)  
Проверяет, содержится ли файл в списке исключённых (с учётом шаблонов).  
Аргументы  
_fs — ссылка на файловую систему (используется для загрузки списка при необходимости).  
filename — полный путь к файлу для проверки.  
Возвращает  
true, если файл должен быть исключён из отображения; иначе false.

---
void SPIFFSEditor::handleRequest(AsyncWebServerRequest *request)  
Обработка HTTP-запросов к редактору файлов  
Аргументы  
request — указатель на объект запроса от AsyncWebServer  
Возвращает  
Отправляет HTTP-ответ с содержимым файла, статусом операции или ошибкой  
Исключения  
Отсутствуют

---
void SPIFFSEditor::handleUpload(AsyncWebServerRequest *request, const String& filename, size_t index, uint8_t *data, size_t len, bool final)  
Обработка поступления данных при загрузке файла  
Аргументы  
request — указатель на текущий HTTP-запрос  
filename — имя загружаемого файла  
index — индекс текущего блока данных (смещение)  
data — указатель на буфер с данными  
len — длина текущего блока данных  
final — флаг, указывающий, является ли текущий блок последним  
Возвращает  
Записывает данные в файл, завершает загрузку и при необходимости инициирует дополнительные действия (например, загрузку Lua-скрипта)  
Исключения  
Отсутствуют
