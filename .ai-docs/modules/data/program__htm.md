# data/program

Модуль отвечает за управление параметрами программы перегонки, включая расчёт объёмов фракций, времени процесса, валидацию данных и обработку пользовательского ввода. Предоставляет функции для обновления параметров колонны, сохранения и загрузки программ, переключения вкладок интерфейса, а также форматирования и проверки данных программы. Все операции синхронизированы с DOM и реагируют на изменения ввода, обеспечивая корректность расчётов при смене типа сырья или параметров режима.

Ключевые структуры данных  
glcalcnum — флаг, указывающий, требуется ли пересчёт программы при изменении параметров  
programerr — флаг ошибки в программе, устанавливается при неверных суммарных объёмах фракций  
pwr_unit — единица измерения мощности (например, 'P' для относительных единиц)

---
updateColumnParams()  
обновляет параметры колонны при смене типа сырья  
Аргументы  
нет  
Возвращает  
нет  
Исключения  
нет

---
fetch(fn).then(response => response.text()).then((data) => { document.getElementById('WProgram1').value = data; glcalcnum = false; calc_program(); })  
загружает текст программы из внешнего источника и инициирует её пересчёт  
Аргументы  
fn — URL или путь к файлу с программой  
Возвращает  
нет  
Исключения  
нет

---
SaveProgramToFile()  
сохраняет текущую программу в локальный файл с именем programbackup.txt  
Аргументы  
нет  
Возвращает  
нет  
Исключения  
нет

---
openTab(evt, tabName)  
активирует указанную вкладку интерфейса и скрывает остальные  
Аргументы  
evt — событие клика по вкладке  
tabName — имя вкладки (идентификатор элемента)  
Возвращает  
0  
Исключения  
нет

---
check_program(str)  
проверяет корректность формата программы по разделителям и структуре строк  
Аргументы  
str — строка с текстом программы, разделённой переносами и точкой с запятой  
Возвращает  
true, если структура программы корректна; иначе false  
Исключения  
нет

---
get_time(tm)  
преобразует время в десятичных часах в строку формата "ЧЧ:ММ"  
Аргументы  
tm — время в часах (число с плавающей точкой)  
Возвращает  
строку в формате "ЧЧ:ММ"  
Исключения  
нет

---
set_num()  
выполняет расчёт объёмов, времени и формирование строк программы на основе текущих данных в таблице  
Аргументы  
нет  
Возвращает  
значение флага programerr (true при ошибках, иначе false)  
Исключения  
нет

---
prep_calc()  
выполняет предварительный расчёт объёмов и коэффициентов для фракций на основе входных параметров  
Аргументы  
нет  
Возвращает  
нет  
Исключения  
нет

---
calc_program()  
инициирует полный пересчёт программы с учётом текущих параметров и единиц измерения  
Аргументы  
нет  
Возвращает  
нет  
Исключения  
нет

---
init_program()  
Инициализирует интерфейс редактирования программы: очищает текущие строки, создаёт заголовок и заполняет содержимое на основе текстового поля.  
Аргументы  
Нет аргументов  
Возвращает  
void  
Исключения  
Нет

---
set_program()  
Выполняет валидацию программы, отправляет её на сервер и обрабатывает ответ.  
Аргументы  
Нет аргументов  
Возвращает  
0 — в случае успешной отправки или ошибки; при успешной отправке может отобразить текущую программу из ответа сервера.  
Исключения  
Вызывает alert при ошибках валидации или HTTP-ошибках.

---
sendbutton(command)  
Отправляет GET-запрос на сервер с указанным командным параметром.  
Аргументы  
command — строка с параметрами команды, добавляемая к URL.  
Возвращает  
0 — после завершения выполнения (включая задержку).  
Исключения  
Вызывает alert при HTTP-ошибках.

---
removeLine(ln)  
Удаляет строку программы по её идентификатору, если количество строк больше минимального.  
Аргументы  
ln — строковый идентификатор удаляемой строки (например, "prgln2").  
Возвращает  
void  
Исключения  
Нет

---
addLine(obj, s)  
Добавляет новую строку программы в интерфейс на основе переданных данных или копирует значения из существующей строки.  
Аргументы  
obj — идентификатор родительского элемента, после которого нужно вставить строку; если false, добавляется в конец.  
s — строка данных программы в формате "ёмкость;скорость;процент;тип;мощность", или пустая строка для создания новой.  
Возвращает  
void  
Исключения  
Нет

---
set_bgcolor(obj)  
Устанавливает цвет фона строки программы в зависимости от выбранного типа фракции.  
Аргументы  
obj — индекс строки программы (число), по которому определяется элемент и его тип.  
Возвращает  
void  
Исключения  
Нет

---
displayColumnParams()  
Пересчитывает и отображает параметры производительности колонны (захлёб, рабочая мощность, скорость отбора).  
Аргументы  
нет  
Возвращает  
нет  
Исключения  
нет

---
getProgramFromFile(selectElement)  
Загружает параметры программы перегонки из файла в зависимости от выбранного типа сырья.  
Аргументы  
selectElement — HTML-элемент <select>, содержащий выбранный тип сырья  
Возвращает  
нет  
Исключения  
нет

---
updateHeadsTailsPercent()  
Устанавливает начальные значения процентов голов и хвостов в зависимости от выбранного типа сырья.  
Аргументы  
нет  
Возвращает  
нет  
Исключения  
нет

---
applyRecommendedSpeeds()  
Применяет рекомендованные скорости отбора (головы, тело, хвосты) в интерфейсе на основе расчётов.  
Аргументы  
нет  
Возвращает  
нет  
Исключения  
нет

---
highlight(obj)  
Подсвечивает элемент и его дочерние узлы цветом, соответствующим типу продукта (головы, тело, промежуточный, хвосты и т.д.).  
Аргументы  
obj — идентификатор элемента, определяющего тип продукта (например, "H" для голов)  
Возвращает  
нет  
Исключения  
нет

---
window.onload = function()  
Инициализирует интерфейс при загрузке страницы: обновляет параметры колонны, загружает программу и устанавливает обработчики событий.  
Аргументы  
нет  
Возвращает  
нет  
Исключения  
нет

---
class tooltip  
Отображает всплывающую подсказку с информацией о параметрах отбора  
Поля  
tooltiptext — текст подсказки с детальными параметрами для разных типов сырья  
Методы  
нет
