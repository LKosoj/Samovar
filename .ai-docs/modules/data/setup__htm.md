# data/setup

Модуль предоставляет функциональность для управления и настройки процессов дистилляции и ректификации в системе "Самовар" через веб-интерфейс. Он включает в себя обработку пользовательских действий, взаимодействие с сервером, сериализацию форм, загрузку и сохранение конфигураций, а также валидацию ввода. Основное назначение — обеспечение удобного и надёжного интерфейса для настройки режимов работы, параметров температуры, насоса, НБК и других компонентов.

Ключевые структуры данных  
FormData — объект, содержащий данные формы для отправки на сервер  
XMLHttpRequest — объект для выполнения HTTP-запросов к серверу устройства

void openTab(evt, tabName)  
Активирует вкладку с указанным именем и скрывает остальные  
Аргументы  
evt — событие, вызвавшее переключение вкладки  
tabName — имя вкладки для отображения  
Возвращает  
Нет  
Исключения  
Нет

---
void sendbutton(command)  
Отправляет GET-запрос на сервер с указанным командным параметром  
Аргументы  
command — строка с командой, добавляемой к URL `/command?`  
Возвращает  
Нет  
Исключения  
Нет

---
int set_program()  
Отправляет данные формы на сервер по адресу `/program` методом POST  
Аргументы  
Нет  
Возвращает  
0  
Исключения  
Показывает alert в случае ошибки HTTP-запроса

---
string HTMLElement.prototype.serialize()  
Сериализует элемент формы в JSON-строку, включая текстовые поля, чекбоксы, цвета, слайдеры и select  
Аргументы  
Нет  
Возвращает  
JSON-строка с именами и значениями полей формы  
Исключения  
Нет

---
void loadFile(e)  
Читает файл в формате JSON и передаёт данные для заполнения формы  
Аргументы  
e — объект File, представляющий загружаемый файл  
Возвращает  
Нет  
Исключения  
Нет

---
void mapJson(data)  
Заполняет поля формы значениями из JSON-объекта  
Аргументы  
data — объект JSON с параметрами для установки в поля формы  
Возвращает  
Нет  
Исключения  
Нет

---
void SaveFormToFile(form)  
Сохраняет данные формы в локальный файл в формате текста  
Аргументы  
form — элемент формы, данные которой нужно сохранить  
Возвращает  
Нет  
Исключения  
Нет

---
void sleep(milliseconds)  
Выполняет блокирующую задержку выполнения кода на указанное количество миллисекунд  
Аргументы  
milliseconds — количество миллисекунд для задержки  
Возвращает  
Ничего  
Исключения  
Нет

---
Модуль отвечает за конфигурацию параметров оборудования и настройки температурных датчиков в системе управления ректификационной установкой. Предоставляет интерфейс для выбора физических характеристик колонны, управления аварийными срабатываниями, настройки уведомлений и калибровки датчиков. Включает элементы управления через HTML-формы с динамической подстановкой значений (шаблонизация).

Ключевые структуры данных  
ColDiam — Диаметр колонны в дюймах (1.5, 2.0, 3.0)  
ColHeight — Высота насадки колонны в метрах (от 0.50 до 2.50)  
PackDens — Плотность упаковки насадки в процентах (60–100%)

float ColDiam(value)  
Выбор диаметра ректификационной колонны  
Аргументы  
value — Значение диаметра в дюймах (1.5, 2.0, 3.0)  
Возвращает  
Выбранное значение диаметра колонны  
Исключения  
Нет

---
float ColHeight(value)  
Выбор высоты насадки ректификационной колонны  
Аргументы  
value — Значение высоты в метрах (от 0.50 до 2.50 с шагом 0.25)  
Возвращает  
Выбранное значение высоты насадки  
Исключения  
Нет

---
int PackDens(value)  
Установка плотности упаковки насадки  
Аргументы  
value — Процент плотности упаковки (60–100%)  
Возвращает  
Текущее значение плотности насадки  
Исключения  
Нет

---
bool useautospeed(checked)  
Включение корректировки скорости насоса при превышении температуры пара  
Аргументы  
checked — Флаг включения (true/false)  
Возвращает  
Состояние чекбокса (включено/выключено)  
Исключения  
Нет

---
bool useDetectorOnHeads(checked)  
Использование детектора на головах при ректификации  
Аргументы  
checked — Флаг активации детектора  
Возвращает  
Состояние использования детектора  
Исключения  
Нет

---
float MaxPressureValue(value)  
Установка порога давления для аварийного режима  
Аргументы  
value — Значение давления в мм рт. ст.  
Возвращает  
Пороговое значение давления, при котором сработает авария  
Исключения  
Нет

---
bool UseBuzzer(checked)  
Включение зуммера для системных уведомлений  
Аргументы  
checked — Флаг включения физического зуммера  
Возвращает  
Состояние использования зуммера  
Исключения  
Нет

---
bool UseBBuzzer(checked)  
Включение зуммера в браузере  
Аргументы  
checked — Флаг включения звуковых уведомлений в веб-интерфейсе  
Возвращает  
Состояние использования браузерного зуммера  
Исключения  
Нет

---
bool ChangeProgramBuzzer(checked)  
Включение зуммера при смене программы  
Аргументы  
checked — Флаг активации звукового оповещения  
Возвращает  
Состояние оповещения при смене программы  
Исключения  
Нет

---
void selftest(onclick)  
Запуск процедуры самотестирования оборудования  
Аргументы  
onclick — Событие клика, вызывает sendbutton("startst")  
Возвращает  
Запускает тест насоса, клапана, перистальтического насоса и сервопривода  
Исключения  
Нет

---
string SteamAddr(value)  
Выбор адреса датчика температуры пара перед дефлегматором  
Аргументы  
value — Адрес датчика (подставляется через шаблон %SteamAddr%)  
Возвращает  
Выбранный адрес датчика температуры  
Исключения  
Нет

---
float DeltaSteamTemp(value)  
Корректировка показаний датчика температуры пара  
Аргументы  
value — Значение коррекции в °C  
Возвращает  
Скорректированное значение температуры  
Исключения  
Нет

---
float SetSteamTemp(value)  
Уставка срабатывания по температуре пара  
Аргументы  
value — Пороговое значение температуры в °C  
Возвращает  
Температурную уставку для срабатывания  
Исключения  
Нет

---
int SteamDelay(value)  
Задержка отбора при превышении температуры пара  
Аргументы  
value — Время задержки в секундах  
Возвращает  
Время задержки перед возобновлением отбора  
Исключения  
Нет

---
Модуль отвечает за конфигурацию и управление параметрами температурных датчиков, насосов и PID-регулятора в системе контроля брожения и нагрева. Предоставляет интерфейс для настройки уставок, коррекций температуры, задержек срабатывания и калибровки оборудования. Поддерживает взаимодействие с датчиками по адресам, настройку шаговых двигателей и параметров нагрева в зависимости от режима.

Ключевые структуры данных  
SensorConfig — Хранит параметры датчика: адрес, коррекцию, уставку и задержку срабатывания  
PumpCalibration — Определяет калибровочные коэффициенты насоса (шаги на миллилитр)  
PIDSettings — Содержит коэффициенты Kp, Ki, Kd и напряжения для режимов поддержания и кипения

void saveConfig()  
Сохраняет текущие настройки в энергонезависимую память устройства  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет

---
void loadConfig()  
Загружает сохранённые настройки из энергонезависимой памяти  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет

---
void scanSensors()  
Инициирует сканирование шины (например, One-Wire) для обнаружения подключённых датчиков температуры  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет

---
float readTemperature(uint8_t address)  
Считывает текущее значение температуры с датчика по заданному адресу  
Аргументы  
address — Адрес датчика на шине  
Возвращает  
Текущая температура в градусах Цельсия  
Исключения  
Нет

---
class SensorConfig  
Хранит конфигурацию одного температурного датчика  
Поля  
address — Адрес датчика в сети (например, One-Wire)  
delta — Корректировка показаний датчика, °C  
setpoint — Уставка срабатывания, °C  
delay — Задержка срабатывания, сек

---
class PumpCalibration  
Определяет калибровочные параметры дозирующего насоса  
Поля  
stepsPerMl — Количество шагов двигателя, соответствующее одному миллилитру  
stepsPerMlI2C — Количество шагов I2C-насоса на миллилитр (если используется)

---
class PIDSettings  
Хранит параметры PID-регулятора и выходной мощности  
Поля  
Kp — Пропорциональный коэффициент  
Ki — Интегральный коэффициент  
Kd — Дифференциальный коэффициент  
stbVoltage — Напряжение в режиме поддержания температуры  
boilVoltage — Напряжение в режиме кипения  
useBoostElement — Флаг использования дополнительного ТЭНа при кипении

---
Модуль отвечает за веб-интерфейс конфигурации устройства "Самовар", предоставляя пользователю формы для настройки параметров работы, подключения к внешним сервисам, управления реле и восстановления/сохранения конфигурации. Интерфейс разделён на вкладки, каждая из которых отвечает за определённую группу параметров. Данные передаются и подставляются в шаблон через теги вида `%KEY%`, обрабатываемые на стороне сервера.

Ключевые структуры данных  
ConfigData — Структура, содержащая все параметры конфигурации устройства, такие как токены, настройки датчиков, реле и интервалы логирования.

void saveform(this)  
Сохраняет текущие настройки формы в файл конфигурации на устройстве  
Аргументы  
this — ссылка на элемент кнопки, вызывающий функцию  
Возвращает  
void  
Исключения  
Нет

---
void resetwifi()  
Сбрасывает настройки Wi-Fi на устройстве, возвращая к заводским по умолчанию  
Аргументы  
Нет  
Возвращает  
void  
Исключения  
Нет

---
void reboot()  
Инициирует перезагрузку устройства "Самовар"  
Аргументы  
Нет  
Возвращает  
void  
Исключения  
Нет

---
void loadFile(file)  
Загружает и обрабатывает файл конфигурации, выбранный пользователем  
Аргументы  
file — объект File, выбранный через input[type="file"]  
Возвращает  
void  
Исключения  
Может выбросить ошибку при чтении файла или при неверном формате

---
void sendbutton(command)  
Отправляет команду на сервер устройства через HTTP-запрос  
Аргументы  
command — строка с командой (например, "reboot" или "resetwifi=1")  
Возвращает  
void  
Исключения  
Может выбросить исключение при ошибке сети или недоступности сервера

---
void SaveFormToFile(button)  
Сохраняет данные всех полей формы в конфигурационный файл, отправляя их на сервер  
Аргументы  
button — ссылка на элемент кнопки, инициирующий сохранение  
Возвращает  
void  
Исключения  
Может выбросить исключение при ошибках отправки данных

---
class tooltip  
Обеспечивает отображение всплывающей подсказки при наведении на элемент  
Поля  
tooltiptext — текст подсказки, отображаемый внутри span с классом "tooltiptext"

---
Модуль предоставляет веб-интерфейс для сохранения данных и навигации между страницами. Основные элементы — кнопки действий, реализованные как элементы формы и кнопки с JavaScript-обработчиками. Интерфейс предназначен для простого взаимодействия пользователя с системой через стандартные действия: сохранение, возврат на главную страницу и переход в редактор.

Ключевые структуры данных  
HTMLElement — Элементы управления интерфейсом, такие как кнопки формы и навигации

void <input id='save' type='submit' name='save' value='Сохранить' class="button">  
Отправляет форму для сохранения данных  
Аргументы  
id — Уникальный идентификатор элемента  
name — Имя поля формы, передаваемое при отправке  
value — Отображаемый текст кнопки  
class — CSS-класс для стилизации  
Возвращает  
Данные формы, отправленные на сервер  
Исключения  
Нет

---
void <input id='return' type='button' name='return' value='На главную' onclick='javascript:location.href="index.htm"' class="button">  
Переходит на главную страницу  
Аргументы  
id — Уникальный идентификатор элемента  
name — Имя кнопки  
value — Отображаемый текст кнопки  
onclick — Обработчик события, выполняющий переход по URL  
class — CSS-класс для стилизации  
Возвращает  
Нет  
Исключения  
Нет

---
void <input id='edit' type='button' name='edit' value='Редактор' onclick='javascript:location.href="/edit"' class="button">  
Переходит в редактор конфигурации  
Аргументы  
id — Уникальный идентификатор элемента  
name — Имя кнопки  
value — Отображаемый текст кнопки  
onclick — Обработчик события, выполняющий переход на страницу редактирования  
class — CSS-класс для стилизации  
Возвращает  
Нет  
Исключения  
Нет
