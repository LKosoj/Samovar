# data/nbk

Модуль отвечает за управление интерфейсом и взаимодействие с сервером в веб-приложении для контроля оборудования. Реализует отображение и обработку сообщений, работу с программами управления, отправку команд на сервер и обработку пользовательских действий. Включает функции валидации, анимации, управления звуковыми оповещениями и динамического обновления состояния интерфейса.

Ключевые структуры данных  
Messages_Array — массив строк, содержащих HTML-представления сообщений с возможными признаками тревоги  
is_ALARM — флаг, указывающий на наличие активных тревог в последних сообщениях  
IsOffline — признак обрыва связи с сервером  
OfflineCounter — счётчик последовательных неудачных попыток соединения  
sound_is_on — признак включения звуковых оповещений  
IsCalmingPause — признак паузы при отборе для предотвращения дублирования сообщений  

void ConnectError(Type)  
Обновляет индикатор состояния соединения и управляет оповещениями при обрыве связи  
Аргументы  
Type — булево значение: true означает ошибку соединения, false — восстановление  
Возвращает  
Исключения  

---
void setPowerUnit()  
Настраивает отображение элементов интерфейса в зависимости от выбранной единицы мощности (Вт или В)  
Аргументы  
Возвращает  
Исключения  

---
void AddLuaButtons()  
Динамически создаёт и добавляет кнопки выполнения Lua-скриптов на основе переданного списка  
Аргументы  
Возвращает  
Исключения  

---
void playSound(play)  
Управляет воспроизведением звукового сигнала тревоги  
Аргументы  
play — булево значение: true для запуска, false для остановки воспроизведения  
Возвращает  
Исключения  

---
Array getHistory()  
Возвращает историю сообщений из локального хранилища браузера  
Аргументы  
Возвращает  
Массив строк с HTML-представлением сообщений  
Исключения  

---
void saveHistory(message)  
Сохраняет новое сообщение в историю в локальном хранилище  
Аргументы  
message — строка с HTML-представлением сообщения  
Возвращает  
Исключения  

---
void showHystory()  
Переключает видимость окна истории сообщений  
Аргументы  
Возвращает  
Исключения  

---
void clearHystory()  
Очищает историю сообщений в локальном хранилище и обновляет отображение  
Аргументы  
Возвращает  
Исключения  

---
void addMessage(msg, lvl)  
Добавляет новое сообщение в очередь с указанием уровня приоритета  
Аргументы  
msg — текст сообщения  
lvl — уровень сообщения (0 — тревога, 1 — предупреждение, 2 — информационное)  
Возвращает  
Исключения  

---
void removeLastMessage()  
Удаляет последнее сообщение из очереди и обновляет отображение  
Аргументы  
Возвращает  
Исключения  

---
void showMessages()  
Отображает все сообщения из Messages_Array в DOM, проверяет наличие тревог и управляет звуком  
Аргументы  
Возвращает  
Исключения  

---
void initPage()  
Инициализирует интерфейс: настраивает единицы измерения, добавляет кнопки Lua, запускает таймер обновления данных  
Аргументы  
Возвращает  
Исключения  

---
void updateData()  
Выполняет периодический AJAX-запрос к серверу для получения текущего состояния устройства  
Аргументы  
Возвращает  
Исключения  

---
void updateUI(data)  
Обновляет интерфейс на основе полученных от сервера данных  
Аргументы  
data — объект JSON с текущими показаниями и состоянием устройства  
Возвращает  
Исключения  

---
void setTargetTemp()  
Устанавливает целевую температуру, валидируя введённое значение  
Аргументы  
Возвращает  
Исключения  

---
void setTargetPower()  
Устанавливает целевую мощность, валидируя введённое значение  
Аргументы  
Возвращает  
Исключения  

---
void run_lua(command)  
Отправляет команду Lua на выполнение на сервере  
Аргументы  
command — строка с Lua-командой  
Возвращает  
Исключения  

---
void startProgram()  
Запускает выбранную программу дистилляции или ректификации  
Аргументы  
Возвращает  
Исключения  

---
void stopProgram()  
Останавливает текущую программу  
Аргументы  
Возвращает  
Исключения  

---
void abortProcess()  
Выполняет аварийную остановку процесса с подтверждением от пользователя  
Аргументы  
Возвращает  
Исключения  

---
void rebootDevice()  
Инициирует перезагрузку устройства с подтверждением от пользователя  
Аргументы  
Возвращает  
Исключения  

---
void initChart()  
Инициализирует график температур с использованием Chart.js  
Аргументы  
Возвращает  
Исключения
