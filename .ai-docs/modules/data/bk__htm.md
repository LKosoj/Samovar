# data/bk

Модуль реализует клиентскую логику веб-интерфейса управления устройством, включая отображение сообщений, обработку пользовательских действий, взаимодействие с сервером через HTTP-запросы и управление состоянием интерфейса. Основные функции — добавление и удаление сообщений с поддержкой тревожных уведомлений, отправка команд, валидация и синхронизация данных программы, а также динамическое обновление состояния элементов интерфейса. Модуль работает с DOM, обрабатывает формы и управляет асинхронными запросами.

Ключевые структуры данных  
Messages_Array — массив строк, содержащих HTML-представления сообщений с признаками тревоги и обработчиками кликов  
is_ALARM — флаг, указывающий на наличие хотя бы одного тревожного сообщения в очереди  
sound_play_count — счётчик воспроизведений звукового сигнала, используется для контроля повторного запуска

void ConnectError(Type)  
Обновляет индикатор состояния соединения и управляет уведомлениями при обрыве/восстановлении связи.  
Аргументы  
Type — true, если произошёл обрыв; false — если соединение восстановлено.  
Возвращает  
Нет  
Исключения  
Нет  
---  
void setPowerUnit()  
Настраивает отображение элементов управления мощностью в зависимости от выбранной единицы измерения.  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет  
---  
void AddLuaButtons()  
Динамически создаёт кнопки на основе списка команд Lua, переданного через шаблон.  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет  
---  
void playSound(play)  
Управляет воспроизведением звукового сигнала тревоги.  
Аргументы  
play — true для запуска звука, false для остановки.  
Возвращает  
Нет  
Исключения  
Нет  
---  
string[] getHistory()  
Получает историю сообщений из localStorage.  
Возвращает  
Массив строк с HTML-представлением сообщений.  
Исключения  
Нет  
---  
void saveHistory(message)  
Сохраняет новое сообщение в историю в localStorage.  
Аргументы  
message — HTML-строка с сообщением для сохранения.  
Возвращает  
Нет  
Исключения  
Нет  
---  
void showHistory()  
Показывает или скрывает блок истории сообщений.  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет  
---  
void clearHistory()  
Очищает историю сообщений в localStorage и обновляет отображение.  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет  
---  
void addMessage(msg, lvl)  
Добавляет новое сообщение в очередь интерфейса и в историю.  
Аргументы  
msg — Текст сообщения.  
lvl — Уровень сообщения (0 — ошибка/тревога, 1 — предупреждение, 2 — информационное).  
Возвращает  
Нет  
Исключения  
Нет  
---  
void removeLastMessage()  
Удаляет последнее сообщение из очереди отображения.  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет  
---  
window.onload  
Инициализирует интерфейс при загрузке страницы: настраивает единицы мощности, добавляет Lua-кнопки, устанавливает индикатор соединения.  
Аргументы  
Нет  
Возвращает  
Нет  
Исключения  
Нет
