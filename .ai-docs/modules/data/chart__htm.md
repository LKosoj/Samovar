# data/chart

Модуль реализует интерфейс веб-страницы для мониторинга и управления процессом дистилляции. Основные функции включают регулярное обновление данных с сервера по AJAX, отображение температурных и статусных параметров, визуализацию данных на графике с использованием библиотеки amCharts, а также обработку сообщений и звуковых оповещений.

Ключевые структуры данных  
Messages_Array — массив для хранения отображаемых сообщений, содержащий текст и уровень важности  
sound_is_on — флаг, указывающий, включены ли звуковые оповещения на стороне клиента  
IsCalmingPause — флаг, предотвращающий дублирование сообщений о паузе охлаждения

void ConnectError(bool isError)  
Отображает или скрывает индикатор ошибки соединения  
Аргументы  
isError — true, если соединение с сервером потеряно, иначе false  
---
void playSound(bool play)  
Воспроизводит или останавливает звуковое оповещение в зависимости от состояния  
Аргументы  
play — true для запуска звука, false для остановки  
---
void addMessage(string msg, int lvl)  
Добавляет сообщение в очередь отображаемых сообщений с указанным уровнем приоритета  
Аргументы  
msg — текст сообщения  
lvl — уровень важности: 0 — ошибка (тревога), 1 — информационное, 2 — предупреждение  
---
void removeLastMessage()  
Удаляет последнее сообщение из очереди и обновляет отображение  
---
void showMessages()  
Обновляет содержимое блока сообщений на странице, отображает или скрывает его в зависимости от наличия сообщений  
---
void createChartData()  
Генерирует начальные тестовые данные для графика за последний час  
---
void updateChart()  
Обновляет данные графика, добавляя новую точку и удаляя самую старую  
---
void sendAjaxRequest(string url, function callback)  
Выполняет GET-запрос по указанному URL и вызывает callback при получении ответа  
Аргументы  
url — адрес для запроса  
callback — функция, вызываемая с текстом ответа при успешном выполнении  
Исключения  
При ошибке сети или таймауте вызывается обработчик ConnectError(true)  
---
void updateData()  
Запрашивает актуальные данные с сервера и обновляет соответствующие элементы интерфейса  
---
void run_lua(string script)  
Выполняет удалённый Lua-скрипт через AJAX-запрос и выводит результат в виде сообщения  
Аргументы  
script — имя или код скрипта для выполнения  
---
void saveSettings()  
Отправляет данные формы настроек на сервер и выводит результат операции  
---
void setPowerUnit()  
Настраивает отображение блока управления мощностью в зависимости от выбранной единицы измерения (Вт или Вольты)  
---
void AddLuaButtons()  
Создаёт и добавляет на страницу кнопки, определённые в конфигурации Lua-скриптов  
---
class chart  
График на основе amCharts для визуализации температурных данных в реальном времени  
Поля  
series — линия данных температуры на графике  
Методы  
am4core.create("chartdiv", am4charts.XYChart) — инициализация контейнера графика в элементе с id 'chartdiv'  
chart.dataSource.reloadFrequency = 15000 — устанавливает интервал автоматической перезагрузки данных графика (в миллисекундах)
