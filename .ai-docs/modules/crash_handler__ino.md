# crash_handler

/**
 * @brief Модуль обработки сбоев для ESP32 с сохранением отладочной информации в SPIFFS.
 *
 * Модуль обеспечивает перехват критических ошибок (паника, WDT), формирование отчёта
 * с деталями сбоя (стектрейс, причина перезагрузки, состояние памяти и задач)
 * и сохранение в файл `/crash.txt` на SPIFFS. При отсутствии доступа к файловой системе
 * данные дублируются в Serial. При последующей загрузке возможна диагностика
 * по сохранённому логу.
 *
 * Ключевые структуры данных
 * stacktrace_buffer — Буфер для временного хранения строкового представления стектрейса
 * crash_occurred — Флаг, указывающий, был ли уже зафиксирован сбой
 * fs_available — Флаг доступности файловой системы SPIFFS
 */

String get_reset_reason_string()
@brief Возвращает строковое описание причины последней перезагрузки.
Возвращает
Строка с описанием причины сброса (например, "Сброс из-за паники" или код ошибки)
Исключения
Функция не генерирует исключения
---
void save_stacktrace_to_file(const char* info)
@brief Сохраняет детализированный отчёт о сбое в файл SPIFFS или выводит в Serial при недоступности FS.
Аргументы
info — Дополнительная строка с информацией о контексте сбоя
Исключения
Функция не генерирует исключения, но может выводить данные в Serial при ошибках записи
---
void shutdown_handler()
@brief Обработчик аварийного завершения системы; вызывается при сбое до перезагрузки.
Исключения
Функция не генерирует исключения, использует внутренние проверки на повторный вызов
---
void init_crash_handler()
@brief Инициализирует обработчик сбоев: проверяет доступность SPIFFS и регистрирует shutdown-обработчик.
Исключения
Функция не генерирует исключения, логирует состояние инициализации в Serial
---
void setup_crash_handler()
@brief Инициализирует обработчик сбоев: определяет причину перезагрузки и при необходимости сохраняет лог.
Исключения
Функция не генерирует исключения
---
void check_and_load_crash_log()
@brief Проверяет наличие сохранённого лога сбоя в файловой системе SPIFFS и выводит его содержимое.
Исключения
Функция не генерирует исключения, логирует результат проверки в Serial
---
void force_save_stacktrace(const char* reason)
@brief Принудительно сохраняет указанный текст (например, причину сбоя) в файл лога.
Аргументы
reason — строка с описанием причины, которая будет сохранена в логе
Исключения
Функция не генерирует исключения, выводит данные в Serial при ошибках записи
