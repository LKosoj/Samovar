# mod_rmv

/**
 * @brief Модуль обеспечивает взаимодействие с устройством RMVK через UART-интерфейс с использованием протокола команд AT.
 * Реализована синхронизация доступа к UART с помощью бинарного семафора для предотвращения конфликтов в многозадачной среде FreeRTOS.
 * Поддерживаются команды чтения входного и выходного напряжения, управления состоянием питания и выбора режима работы.
 * Состояние устройства периодически обновляется в фоновом потоке или через вызовы чтения.
 *
 * Ключевые структуры данных
 * rmvk_t — Глобальная структура для хранения текущего состояния устройства RMVK (напряжения, состояние включения, подключение)
 */

---
uint8_t RMVK_cmd(const char* cmd, rmvk_res_t res)
Отправляет AT-команду устройству RMVK и обрабатывает ответ
Аргументы
cmd — Строка с AT-командой (без завершающего \r)
res — Тип ожидаемого ответа (число, OK, ON)
Возвращает
Результат в соответствии с типом res: 0/1 для логических ответов, число для значений, состояние подключения при ошибках
Исключения
Нет явных исключений; при таймауте семафора возвращается состояние подключения

---
uint16_t RMVK_get_in_voltge()
Читает текущее входное напряжение с устройства RMVK
Возвращает
Значение входного напряжения в вольтах (или 0 при ошибке)

---
uint16_t RMVK_get_out_voltge()
Читает текущее выходное напряжение с устройства RMVK
Возвращает
Значение выходного напряжения в вольтах (или 0 при ошибке)

---
uint16_t RMVK_get_store_out_voltge()
Читает сохранённое целевое выходное напряжение из памяти устройства
Возвращает
Сохранённое значение напряжения в вольтах (или 0 при ошибке)

---
bool RMVK_get_state()
Определяет текущее состояние включения выхода устройства
Возвращает
true, если выход включён (ON), иначе false

---
uint16_t RMVK_set_out_voltge(uint16_t voltge)
Устанавливает целевое выходное напряжение устройства
Аргументы
voltge — Желаемое напряжение (ограничивается значением MAX_VOLTAGE)
Возвращает
Установленное значение напряжения (или 0 при ошибке)

---
bool RMVK_get_conn()
Проверяет наличие активного соединения с устройством RMVK
Возвращает
true, если последняя команда была успешной, иначе false

---
uint16_t RMVK_set_on(uint16_t state)
Включает или выключает выход устройства RMVK
Аргументы
state — 0 для выключения, любое другое значение — включение
Возвращает
1 при успешном включении/выключении, 0 при ошибке

---
uint16_t RMVK_select_mem(uint16_t sm)
Выбирает режим работы/памяти устройства RMVK
Аргументы
sm — Номер режима/памяти
Возвращает
1 при успешном выборе (ответ OK), 0 при ошибке

---
void rmvk_read()
Выполняет полное обновление состояния устройства: читает входное, выходное и целевое напряжения, а также состояние включения
Исключения
Нет явных исключений

---
uint8_t get_rmvk_state()
Возвращает текущее состояние включения устройства
Возвращает
Значение поля rmvk.on

---
uint8_t get_rmvk_conn()
Возвращает текущее состояние подключения к устройству
Возвращает
Значение поля rmvk.conn

---
void rmvkFn(void* arg)
Фоновая задача FreeRTOS для периодического опроса состояния RMVK
Аргументы
arg — Не используется
Исключения
Нет явных исключений

---
void RMVK_init(void)
Инициализирует UART-интерфейс и семафор для работы с устройством RMVK
Исключения
Нет явных исключений
