# NVS_Manager

Модуль управления хранением настроек и Wi-Fi параметров для устройства Samovar.  
Модуль отвечает за сохранение и загрузку пользовательских настроек устройства в энергонезависимую память (NVS), а также за работу с Wi-Fi учетными данными через стандартный интерфейс ESP32 WiFi. Использует Preferences для хранения параметров и стандартный namespace WiFi для управления сетевыми настройками.

Ключевые структуры данных  
SamSetup — глобальная структура, содержащая все пользовательские настройки устройства  
SetupEEPROM — устаревшая структура для хранения данных в EEPROM, используется только при миграции

---
bool load_wifi_credentials(char *ssid, size_t ssid_len, char *pass, size_t pass_len)  
Загружает сохранённые Wi-Fi учётные данные через WiFi.SSID().  
Аргументы  
ssid — буфер для записи SSID (не должен быть null)  
ssid_len — размер буфера SSID  
pass — буфер для записи пароля (не используется, пароль недоступен)  
pass_len — размер буфера пароля  
Возвращает  
true, если SSID найден и записан; false в случае ошибки или отсутствия данных

---
String get_wifi_ssid()  
Получает сохранённое имя сети Wi-Fi через системный интерфейс.  
Возвращает  
строку с SSID, если сохранено; пустую строку, если нет

---
void save_wifi_credentials(const char *ssid, const char *pass)  
Сохраняет Wi-Fi учётные данные, используя WiFi.begin() с persistent-режимом.  
Аргументы  
ssid — указатель на строку с SSID (не должен быть null)  
pass — указатель на строку с паролем (может быть null)

---
void clear_wifi_credentials()  
Очищает сохранённые Wi-Fi учётные данные из стандартного namespace.

---
void saveStringIfChanged(const char* key, const char* value)  
Сохраняет строку в NVS только при изменении значения.  
Аргументы  
key — ключ в хранилище NVS  
value — новое значение строки

---
void saveBytesIfChanged(const char* key, const void* value, size_t len)  
Сохраняет байтовый массив в NVS только при изменении.  
Аргументы  
key — ключ в хранилище NVS  
value — указатель на данные  
len — длина данных в байтах

---
void save_profile_nvs()  
Сохраняет текущие настройки из структуры SamSetup в NVS

---
void load_profile_nvs()  
Загружает настройки из NVS в структуру SamSetup с использованием значений по умолчанию при отсутствии данных

---
void reset_profile_nvs()  
Сбрасывает все пользовательские настройки в значения по умолчанию и сохраняет их в NVS.

---
void format_nvs()  
Полностью очищает всё NVS-хранилище устройства.

---
void begin_nvs()  
Инициализирует Preferences для работы с NVS.

---
void end_nvs()  
Завершает работу с NVS, закрывает текущее хранилище.

---
void reset_migration_flag()  
Сбрасывает флаг миграции из EEPROM в NVS, позволяя повторно выполнить миграцию при следующей загрузке

---
void migrate_from_eeprom()  
Выполняет миграцию данных настроек из эмуляции EEPROM в NVS при первом запуске после обновления прошивки  
Исключения  
В случае ошибки чтения из EEPROM или записи в NVS может оставить систему в неизменном состоянии

---
class Preferences  
Класс для работы с энергонезависимым хранилищем NVS в ESP32  
Методы  
bool begin(const char* namespace, bool readonly) — Инициализирует доступ к NVS с указанным именем пространства  
bool putBool(const char* key, bool value) — Сохраняет булево значение по заданному ключу  
void end() — Завершает сессию работы с NVS, освобождая ресурсы
