# Проект Самовар

## Описание
Автоматизированная система управления самогонным аппаратом на базе ESP32.
Устройство контролирует температуры (ТСА, в кубе, в голове колонны, в царге и воды 
на выходе), управляет реле, шаговым двигателем с перистальтическим насосом для 
отбора из РК, сервоприводом для раздельного отбора (10 + 1 емкость). 
Имеет встроенный веб-сервер, сохраняет лог процесса, отображает графики (температуры и давление).
Реализовано аварийное отключение при выходе параметров за допустимые пределы.

## Основные возможности
- Поддержка различных режимов работы:
  - Ректификация
  - Дистилляция
  - БК (Бражная колонна)
  - НБК (Непрерывная бражная колонна)
  - Пивоварение
- Веб-интерфейс управления
- Интеграция:
  - Telegram уведомления
  - MQTT протокол
  - Blynk
  - Облачное хранилище данных
- Программируемые режимы работы через веб-интерфейс
- Встроенный интерпретатор Lua для расширения функционала
- Система безопасности и мониторинга
- Поддержка скриптового языка Lua для расширения функционала
- Возможность задать для каждого режима свои параметры в виде программы, управляющей процессом. Программа задается через веб-интерфейс, представляет собой набор строк, которые выполняются последовательно. Подробнее смотрите в документации и на форуме.
- Графическое отображение процесса
- Сохранение логов

## Требования
### Аппаратные
- ESP32
- Датчики температуры DS18B20 (5 шт)
- Датчик давления (MPX5010D или XGZ)
- LCD дисплей
- Энкодер с кнопкой
- Насос для подачи воды
- Шаговый двигатель
- Перистальтический насос
- Клапаны
- Сервопривод
- Блок питания

Схема подключения
![alt text](https://github.com/LKosoj/Samovar/blob/master/Fritzing%20scheme/
Samovar_bb.png)

### Программные
- PlatformIO IDE или Arduino IDE
- Библиотеки:
  - OneWire
  - DallasTemperature
  - ESPAsyncWebServer
  - AsyncTCP
  - ESPAsyncWiFiManager
  - GyverEncoder
  - GyverButton
  - GyverPID
  - ESP32Servo
  - ArduinoJson
  - LittleFS

## Установка
1. Склонируйте репозиторий
2. Установите PlatformIO IDE или Arduino IDE
3. Установите необходимые библиотеки
4. Настройте параметры в файлах:
   - `Samovar_ini.h` - основные настройки
   - `user_config_override.h` - пользовательские настройки
5. Загрузите прошивку в ESP32
6. Загрузите файлы из папки `data` в файловую систему ESP32

## Структура проекта
- `Samovar.ino` - основной файл проекта
- `Samovar.h` - основные определения
- `logic.h` - логика работы
- `WebServer.ino` - веб-сервер
- `Blynk.ino` - интеграция с Blynk
- `beer.h` - режим пивоварения
- `distiller.h` - режим дистилляции
- `BK.h` - режим бражной колонны
- `nbk.h` - режим непрерывной бражной колонны
- `lua.h` - интерпретатор Lua

## Документация
Полная документация доступна на сайте: https://www.samovar-tool.ru/

## Поддержка
Проект некоммерческий. Обсуждение и поддержка на форуме:
https://forum.homedistiller.ru/index.php?topic=367128.0

## Демонстрация
Примеры работы системы: https://www.samovar-tool.ru/2021/03/21/o-rabote-samovara/
