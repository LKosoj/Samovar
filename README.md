# Samovar
Скетч для ESP32.
Предназначен для управления ректификационной колонной, процессом дистилляции, и пивоварением. Необходимые библиотеки выложены в каталоге library, остальные грузятся из репозитория библиотек через Arduino IDE

Устройство контролирует 5 температур (ТСА, в кубе, в голове колонны, в царге и воды на выходе), управляет 4 реле, управляет шаговиком с перистальтическим насосом для отбора из РК, управляет сервоприводом для раздельного отбора (10 + 1 емкость), работает с экраном и энкодером, работает через веб-сервер ESP32, сохраняет у себя лог погона, на своем веб-сервере рисует графики по логу (4 температуры и давление), работает через Blynk  - можно удаленно с телефона контролировать основные параметры и управлять основными функциями. Реализовано аварийное отключение в случае выхода температур за заданные параметры.

Еще одна возможность: можно задавать программу отбора на весь погон для ректификации. В программе отбора можно указать в какую емкость, какой объем, в каком температурном режиме отбирать текущую часть погона.
Для режима "Пиво" так же предусмотрена программа. Благодаря этому можно варить разные сорта пива в полуавтоматическом режиме, а так же использовать данный скетч для управления нагревателем в режиме су-вид (sous-vide). 

Самовар поддерживает автоматизацию на основе скриптового языка программирования Lua. Редактор скриптов доступен на странице Настроек – Редактор.
Так же в скриптах реализована поддержка модуля PCF8575 – это расширитель на 16 портов, который подключается по I2C.

На расширитель портов можно вешать любые исполнительные устройства или кнопки (датчики, которые работают как кнопки), и самому определить, что должно происходить в тот или иной момент при работе Самовара.
Инициализационный скрипт запускается при старте Самовара, а дальше раз в секунду запускается другой скрипт. В первом можно описать необходимые устройства, во втором описать их поведение. Например, в нем можно сделать проверку по температуре или текущему статусу Самовара, и, например, включить/выключить насос, или открыть/закрыть клапан, или управлять дополнительным тэном. Можно проверить, что не сработал датчик безопасности, а если сработал, то прямо из скрипта можно выключить Самовар, увеличить или остановить подачу воды. Сценариев может быть много. Определяются они конкретным оборудованием.
При этом базовый функционал Самовара не меняется.
Благодаря поддержке скриптов и расширителя портов можно подключать дополнительное оборудование и автоматически управлять им в процессе работы Самовара.

Для работы всего функционала необходимо подключение к интернету. Без интернета не будет работать Blynk и не будут строиться графики (библиотека для графиков грузится из сети, она большая, ее на внутренней памяти не сохранить). Все остальное будет работать. 

Обратите внимание!!! Не смотря на то, что теоретически все автоматизировано (или может быть автоматизировано), присутствие оператора рядом с колонной обязательно! Автоматика позволяет упростить отбор, но сама ничего не сделает. Без понимания процессов оператором это просто прикольная (на мой взгляд) штука.

Документация доступна в wiki по адресу https://github.com/LKosoj/Samovar/wiki

Схема подключения
![alt text](https://github.com/LKosoj/Samovar/blob/master/Fritzing%20scheme/Samovar_bb.png)

Как скомпилировать, загрузить и настроить Самовар:
https://www.samovar-tool.ru/samovar-diy/

Как выглядит реализованное, можно посмотреть тут https://www.samovar-tool.ru/2021/03/21/o-rabote-samovara/

Проект не коммерческий. Обсуждение на форуме https://forum.homedistiller.ru/index.php?topic=367128.120#msg13883184
Все вопросы можно задавать там.
    
